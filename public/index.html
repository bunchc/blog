

<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <base href="http://blog.codybunch.com">
    <title>blog.codybunch.com - The random msuings of an IT guy</title>
    <link rel="canonical" href="http://blog.codybunch.com/">
    <link href="http://blog.codybunch.com/index.xml" rel="alternate" type="application/rss+xml" title="blog.codybunch.com - The random msuings of an IT guy" />

    

<link rel="stylesheet" href="/css/poole.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/lanyon.css">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

</head>
  <body class="theme-base-08" lang="en">

  


<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    <a class="sidebar-nav-item" href="/posts">Blog</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014 Spencer Lyon. Powered by <a href="http://hugo.spf13.com">Hugo</a>. Design adapted from <a href="http://lanyon.getpoole.com">Lanyon</a>.
    </p>
  </div>
</div>


  
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Home</a>
          </h3>
        </div>
      </div>

      
      <div class="container content">
        <h1>This is a Blog</h1>

        
        <h2 class="post-title">Recent Posts</h2>
          <section id="main">
            <ul id="list">
              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-28-Using-Packer-to-Make-Vagrant-Boxes'> Using Packer to Make Vagrant Boxes</a> </h2>
      <div class="meta">Tue, Oct 28, 2014</div>
    </header>

    

<p>Part of working on the 3rd edition of the OpenStack Cookbook required, among other things, a new release of Ubuntu that came pre-loaded with the Juno OpenStack packages. Not a problem! Excepting that there were no ready made images on <a href="http://vagrantcloud.com">Vagrant Cloud</a>. Enter Packer.</p>

<h2 id="toc_0">Packer?</h2>

<p>What the deuce is packer? From the <a href="https://packer.io/">packer.io</a> site:</p>

<blockquote>
<p>Packer is a tool for creating identical machine images for multiple platforms from a single source configuration.</p>
</blockquote>

<p>Said another way, it takes the &lsquo;configuration is code&rsquo; and pushes it back to the golden images, to a degree. The idea is one can shrink the time to deploy if instead of starting with the most generic box and adding, you start somewhere in the middle, adding common things to a &lsquo;golden&rsquo; image, and then deploying on top of that.</p>

<p>In the use-case for the OpenStack Cookbook? Well, we just needed a manila Ubuntu 14.10 box for Fusion and Virtualbox. As there are three of us on the project now, having a common starting ground is ideal.</p>

<h2 id="toc_1">Our Packer Setup</h2>

<p>I&rsquo;ll leave installing Packer as an exercise for the reader. The <a href="https://packer.io/docs">docs</a> are pretty good in the regard.</p>

<p>For our build, we use the following packer.json:</p>

<pre><code>{
  &quot;builders&quot;: [
    {&quot;type&quot;: &quot;virtualbox-iso&quot;,
    &quot;guest_os_type&quot;: &quot;Ubuntu_64&quot;,
    &quot;iso_url&quot;: &quot;http://mirror.anl.gov/pub/ubuntu-iso/CDs/utopic/ubuntu-14.10-server-amd64.iso&quot;,
    &quot;iso_checksum&quot;: &quot;91bd1cfba65417bfa04567e4f64b5c55&quot;,
    &quot;iso_checksum_type&quot;:&quot;md5&quot;,
    &quot;http_directory&quot;: &quot;preseed&quot;,
    &quot;ssh_username&quot;: &quot;vagrant&quot;,
    &quot;ssh_password&quot;: &quot;vagrant&quot;,
    &quot;boot_wait&quot;:&quot;5s&quot;,
    &quot;output_directory&quot;: &quot;ubuntu64_basebox_virtualbox&quot;,
    &quot;shutdown_command&quot;: &quot;echo 'shutdown -P now' &gt; shutdown.sh; echo 'vagrant'|sudo -S sh 'shutdown.sh'&quot;,
    &quot;boot_command&quot;: [
      &quot;&lt;esc&gt;&lt;esc&gt;&lt;enter&gt;&lt;wait&gt;&quot;,
      &quot;/install/vmlinuz noapic &quot;,
      &quot;ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg &quot;,
      &quot;debian-installer=en_US auto locale=en_US kbd-chooser/method=us &quot;,
      &quot;hostname={{ .Name }} &quot;,
      &quot;fb=false debconf/frontend=noninteractive &quot;,
      &quot;keyboard-configuration/modelcode=SKIP keyboard-configuration/layout=USA &quot;,
      &quot;keyboard-configuration/variant=USA console-setup/ask_detect=false &quot;,
      &quot;initrd=/install/initrd.gz -- &quot;,
      &quot;&lt;enter&gt;&quot;]
    },
    {&quot;type&quot;: &quot;vmware-iso&quot;,
    &quot;guest_os_type&quot;: &quot;ubuntu-64&quot;,
    &quot;iso_url&quot;: &quot;http://mirror.anl.gov/pub/ubuntu-iso/CDs/utopic/ubuntu-14.10-server-amd64.iso&quot;,
    &quot;iso_checksum&quot;: &quot;91bd1cfba65417bfa04567e4f64b5c55&quot;,
    &quot;iso_checksum_type&quot;:&quot;md5&quot;,
    &quot;http_directory&quot;: &quot;preseed&quot;,
    &quot;ssh_username&quot;: &quot;vagrant&quot;,
    &quot;ssh_password&quot;: &quot;vagrant&quot;,
    &quot;boot_wait&quot;:&quot;5s&quot;,
    &quot;output_directory&quot;: &quot;ubuntu64_basebox_vmware&quot;,
    &quot;shutdown_command&quot;: &quot;echo 'shutdown -P now' &gt; shutdown.sh; echo 'vagrant'|sudo -S sh 'shutdown.sh'&quot;,
    &quot;boot_command&quot;: [
      &quot;&lt;esc&gt;&lt;esc&gt;&lt;enter&gt;&lt;wait&gt;&quot;,
      &quot;/install/vmlinuz noapic &quot;,
      &quot;ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg &quot;,
      &quot;debian-installer=en_US auto locale=en_US kbd-chooser/method=us &quot;,
      &quot;hostname={{ .Name }} &quot;,
      &quot;fb=false debconf/frontend=noninteractive &quot;,
      &quot;keyboard-configuration/modelcode=SKIP keyboard-configuration/layout=USA &quot;,
      &quot;keyboard-configuration/variant=USA console-setup/ask_detect=false &quot;,
      &quot;initrd=/install/initrd.gz -- &quot;,
      &quot;&lt;enter&gt;&quot;]
    }],
  &quot;provisioners&quot;: [{
    &quot;type&quot;: &quot;shell&quot;,
    &quot;execute_command&quot;: &quot;echo 'vagrant' | sudo -S sh '{{ .Path }}'&quot;,
    &quot;inline&quot;: [
      &quot;apt-get update -y&quot;,
      &quot;apt-get install -y linux-headers-$(uname -r) build-essential dkms&quot;,
      &quot;apt-get clean&quot;,
      &quot;mount -o loop VBoxGuestAdditions.iso /media/cdrom&quot;,
      &quot;sh /media/cdrom/VBoxLinuxAdditions.run&quot;,
      &quot;umount /media/cdrom&quot;,
      &quot;mkdir /home/vagrant/.ssh&quot;,
      &quot;mkdir /root/.ssh&quot;,
      &quot;wget -qO- https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub &gt;&gt; ~/.ssh/authorized_keys&quot;,
      &quot;echo 'vagrant ALL=NOPASSWD:ALL' &gt; /tmp/vagrant&quot;,
      &quot;chmod 0440 /tmp/vagrant&quot;,
      &quot;mv /tmp/vagrant /etc/sudoers.d/&quot;
    ]}],
  &quot;post-processors&quot;: [
  {
      &quot;type&quot;: &quot;vagrant&quot;,
      &quot;override&quot;: {
        &quot;virtualbox&quot;: {
          &quot;output&quot;: &quot;utopic-x64-virtualbox.box&quot;
        },
        &quot;vmware&quot;: {
          &quot;output&quot;: &quot;utopic-x64-vmware.box&quot;
        }
      }
    }
  ]
}
</code></pre>

<p>This in turn calls a kickstart (yes kickstart on Ubuntu) file stored in the preseed folder. This looks like:</p>

<pre><code>install
text

cdrom

lang en_US.UTF-8
keyboard us

network --device eth0 --bootproto dhcp

timezone --utc America/Chicago

zerombr
clearpart --all --initlabel
bootloader --location=mbr

part /boot --fstype=ext3 --size=256 --asprimary
part pv.01 --size=1024 --grow --asprimary
volgroup vg_root pv.01
logvol swap --fstype swap --name=lv_swap --vgname=vg_root --size=1024
logvol / --fstype=ext4 --name=lv_root --vgname=vg_root --size=1024 --grow

auth --enableshadow --enablemd5

# rootpw is vagrant
rootpw --iscrypted $1$dUDXSoA9$/bEOTiK9rmsVgccsYir8W0
user --disabled

firewall --disabled

skipx

reboot

%packages
ubuntu-minimal
openssh-server
openssh-client
wget
curl
git
man
vim
ntp

%post
apt-get update

apt-get upgrade -y linux-generic

update-grub

useradd -m -s /bin/bash vagrant
echo vagrant:vagrant | chpasswd

mkdir -m 0700 -p /home/vagrant/.ssh

curl https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub &gt;&gt; /home/vagrant/.ssh/authorized_keys

chmod 600 /home/vagrant/.ssh/authorized_keys
chown -R vagrant:vagrant /home/vagrant/.ssh

echo &quot;vagrant ALL=(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers

sed -i 's/^PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config

apt-get clean

rm -rf /tmp/*

rm -f /var/log/wtmp /var/log/btmp

history -c
</code></pre>

<p>Once both files are in place and packer is installed, building the images is as simple as:</p>

<p><code>packer build packer.json</code></p>

<p>This will take a <em>long</em> time, but it does eventually get there, and will produce two .box files in the output folders you specified in the packer.json. From there, you can upload them somewhere and have vagrantcloud make them available, as we have under <code>bunchc/utopic-x64</code>.</p>

<h2 id="toc_2">Summary</h2>

<p>In this post we looked at how to use packer.io to build Vagrant boxes for both VMware Workstation / Fusion and Virtualbox.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-28-Using-Packer-to-Make-Vagrant-Boxes'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-27-Changing-Jenkins-Home-Folder'> Changing Jenkins Home Folder</a> </h2>
      <div class="meta">Mon, Oct 27, 2014</div>
    </header>

    

<p>Everything Jenkins does happens in the context of the jenkins user by default. While that sounds obvious, it has some interesting implications if you aren&rsquo;t careful.</p>

<h2 id="toc_0">The Problem</h2>

<p>In my homelab, I&rsquo;ve installed 14.04 onto a 16gb usb key. This is a hold over from the days when it was an ESXi lab, but, it works for the most part. However, for things like downloading vagrant boxes and the like, one needs to mount external storage. Enter the problem: Jenkins sets itself up in /var/lib/jenkins by default, which lives on my very limited usb stick.</p>

<p>This in turn means anytime Jenkins tried to &lsquo;vagrant up&rsquo; a thing, it would fill my root partition trying to store all the temporary files vagrant used. Whoops.</p>

<h2 id="toc_1">Changing the Jenkins Home Directory</h2>

<p>There are a number of posts out there on how to do this. None of them, however, addressed the vagrant issue in particular. To do that, one has to hit it with a larger bat.</p>

<h3 id="toc_2">First Change /etc/defaults</h3>

<p>The first thing to do, is change how Jenkins thinks of itself. The most straight forward way I found was to change that in /etc/defaults/jenkins. This will be around line 23 or 25:</p>

<pre><code># jenkins home location
JENKINS_HOME=/new/location
</code></pre>

<h3 id="toc_3">Then Change /etc/passwd</h3>

<p>This is the step that was needed to fix the problem of Jenkins running vagrant and vagrant subsequently filling /:</p>

<p>Change:
<code>jenkins:x:105:114:Jenkins,,,:/var/lib/jenkins:/bin/bash</code></p>

<p>To this:
<code>jenkins:x:105:114:Jenkins,,,:/new/location:/bin/bash</code></p>

<h3 id="toc_4">Finally Restart Jenkins</h3>

<p>Now to make sure all the things stick:</p>

<p><code>sudo /etc/init.d/jenkins restart</code></p>

<h2 id="toc_5">Summary</h2>

<p>In this post we showed you how to change the Jenkins home directory, and why it&rsquo;s also important to change it in /etc/passwd.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-27-Changing-Jenkins-Home-Folder'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-23-ZeroVM---A-ZeroCloud-Lab'> ZeroVM - A ZeroCloud Lab</a> </h2>
      <div class="meta">Thu, Oct 23, 2014</div>
    </header>

    

<p>At this point we&rsquo;re pretty far down the ZeroVM rabbit hole. We&rsquo;ve covered quite a bit of ground to get to this stage as well. Specific to this post, you will want to know more about ZeroCloud. You can do that <a href="http://blog.codybunch.com/posts/2014-10-13-ZeroVM---Getting-Started-with-ZeroCloud">here</a>.</p>

<p>Regarding getting up to speed on ZeroVM as I am, you will find the following useful:</p>

<ul>
<li><a href="http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background">Background</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO">Isolation</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-21-ZeroVM---IO--Channels/">IO Operations</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again/">Getting Started with ZeroVM</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump">Lots of ZeroVM Resources</a></li>
</ul>

<h2 id="toc_0">Building The ZeroCloud Lab</h2>

<blockquote>
<p>There are a few ways of going about this, however before we get started, realize that this is still early days and if you find this post a few months or a year or two down the road, it will likely be super out of date.</p>
</blockquote>

<p>To get working with ZeroCloud, the most straight forward path is to follow the directions in the ZeroVM Docs <a href="http://docs.zerovm.org/zerocloud/devenv.html">here</a>.</p>

<p>Once you&rsquo;ve finished, you should have a functional ZeroCloud lab.</p>

<h2 id="toc_1">Experimenting in the ZeroCloud Lab</h2>

<p>Having a lab up in running is one thing, but it&rsquo;s rather boring thing by itself. So, let&rsquo;s do something with it!</p>

<h3 id="toc_2">ZeroCloud Hello World Example</h3>

<p>The first thing we&rsquo;ll try to do, is a generic &ldquo;Hello World&rdquo; example, taken from <a href="http://docs.zerovm.org/zerocloud/runningcode.html">here</a>.</p>

<p><strong>1.</strong> Log into the lab:</p>

<pre><code>vagrant ssh

cd devstack/
./rejoin-stack.sh
source /vagrant/adminrc

zpm auth
export OS_AUTH_TOKEN=PKIZ_Zrz_Qa5NJm44FWeF7Wp...
export OS_STORAGE_URL=http://127.0.0.1:8080/v1/AUTH_7fbcd8784f8843a180cf187bbb12e49c
</code></pre>

<blockquote>
<p><strong>Note:</strong> You will need to change the AUTH_TOKEN and STORAGE_URL values to match those returned by zpm auth.</p>
</blockquote>

<p><strong>2.</strong> Create our &ldquo;Hello World&rdquo; python file:</p>

<pre><code>cat &gt; example &lt;&lt;EOF
#!file://python2.7:python
import sys
print(&quot;Hello from ZeroVM!&quot;)
print(&quot;sys.platform is '%s'&quot; % sys.platform)
EOF
</code></pre>

<p><strong>3.</strong> Now we run the example:</p>

<pre><code>curl -i -X POST -H &quot;X-Auth-Token: $OS_AUTH_TOKEN&quot; \
  -H &quot;X-Zerovm-Execute: 1.0&quot; -H &quot;Content-Type: application/python&quot; \
  --data-binary @example $OS_STORAGE_URL
</code></pre>

<p>Ok, so what did we do then? In the first step we logged in to our lab, sourced a file that contains credentials for our environment, and then set some additional environment variables to store our auth token and swift url.</p>

<p>Next we created the hello-world example file. In the absence of a text editor we just dumped everything between &ldquo;&lt;&lt;EOF&rdquo; and &ldquo;EOF&rdquo; into the file &lsquo;example&rsquo;. Note the first line in the file begins with <code>#!file://</code>. This is important as it lets the parser know what to do with said file, in this case, fire up python.</p>

<p>Finally, we use curl against our Swift install, letting it know to jump out to the ZeroVM middleware and that our application type is python. Additionally we specify our entire program as the payload in <code>--data-binary</code></p>

<h2 id="toc_3">Summary</h2>

<p>In this post, we showed you how to build a ZeroCloud lab and run an example &ldquo;Hello World&rdquo; application within it. If you would like to explore some more complex applications, be sure to explore the various talks and videos <a href="http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump">here.</a></p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-23-ZeroVM---A-ZeroCloud-Lab'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-22-ZeroVM---Getting-Started-with-ZeroCloud'> ZeroVM - Getting Started with ZeroCloud</a> </h2>
      <div class="meta">Wed, Oct 22, 2014</div>
    </header>

    

<p>If you are getting up to speed on ZeroVM as I am, you will find the following useful:</p>

<ul>
<li><a href="http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background">Background</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO">Isolation</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-21-ZeroVM---IO--Channels/">IO Operations</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again/">Getting Started with ZeroVM</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump">Lots of ZeroVM Resources</a></li>
</ul>

<p>Additionally, this <a href="https://www.packtpub.com/books/content/mapreduce-openstack-swift-and-zerovm">post</a> does a great job of explaining how ZeroVM fits when you start to approach middling to large (Read: <em>Big Data</em>) problems. Go read it now.</p>

<h2 id="toc_0">Getting Started with ZeroCloud</h2>

<p>Now that you&rsquo;ve read the <a href="https://www.packtpub.com/books/content/mapreduce-openstack-swift-and-zerovm">introduction by Lars</a>, and I trust that you have, we can start looking into the &lsquo;what&rsquo; of ZeroCloud. In this post we&rsquo;ll touch on it&rsquo;s architecture and use case or two. In a subsequent post we&rsquo;ll show you how to build your own small-scale lab for such an environment.</p>

<p><strong>Note:</strong> Also go here, watch <a href="https://www.youtube.com/watch?v=VYZU_4w_dCA">this</a>, around the 16:30 mark, pay attention to the &rsquo;t = data / Rate&rsquo; bits.</p>

<p><strong>Note:</strong> This is where things in ZeroVM start to get really cool.</p>

<h3 id="toc_1">ZeroCloud Architecture</h3>

<p>The best way to describe the what and how of ZeroCloud is with a few diagrams which we will then dive into. These are borrowed form slides in past presentations.</p>

<p><img src="http://openstack.prov12n.com/screens/1e1bd9b12a3230982c98-e2a0e10379dcd0e09ec354fba3ca6600.r72.cf1.rackcdn.comZeroCloud.pdf_2014-10-21_13-09-08.jpg" alt="Highlevel ZeroCloud Architecture" />
</p>

<p>This first diagram is a <em>hugely</em> simplified view of a swift environment, that is, if you have worked with OpenStack Swift it should look familiar enough. The &ldquo;Proxy&rdquo; nodes at the top are Swift Proxies, the Storage Nodes below are well, object storage nodes.</p>

<p>What changes for ZeroCloud is the addition of a few ZVM parts made available via Swift Middleware. In this case ZVM represents job brokers, some messaging, ZeroVM itself, as well as an &lsquo;executor&rsquo; that handles the connecting of channels and the reading / writing of objects in Swift. This next diagram breaks that down further:</p>

<p><img src="http://openstack.prov12n.com/screens/1e1bd9b12a3230982c98-e2a0e10379dcd0e09ec354fba3ca6600.r72.cf1.rackcdn.comZeroCloud.pdf_2014-10-21_13-10-12.jpg" alt="ZeroCloud Dataflow Architecture" />
</p>

<p>In this diagram, which admittedly is an eyechart, each step in the ZeroVM Swift Middleware is shown. Working left to right:</p>

<p><strong>1.</strong> The user initiates a job request via the Swift REST API by sending a post request with the code to be executed.</p>

<p><strong>2.</strong> This hits the Swift Proxy node and is handed to the ZeroVM middleware, which, via a job scheduler finds where the closest replica of your data is, and sends the request along.</p>

<p><strong>3.</strong> The job arrives at the executor who then fires up a net-new ZeroVM session for the job, opens the required IO Channels to your file* and if needed other ZeroVM sessions.</p>

<p><strong>4.</strong> The ZeroVM job, finished with it&rsquo;s work, sends the response back up to the Proxy Server who then serves the response back to the user.</p>

<blockquote>
<p><em>Note:</em> re: file in #3, in the default configuration this is a net new copy of the file rather than the actual object itself. This prevents accidental damage to the file.</p>
</blockquote>

<h3 id="toc_2">ZeroCloud Use Cases</h3>

<p>So what do you do with a deterministic, computable, distributed data store? Some things that jump to mind are things like &ldquo;A Giant MapReduce Cluster&rdquo;, similar to the one described <a href="https://www.packtpub.com/books/content/mapreduce-openstack-swift-and-zerovm">here</a>. As Lars describes, ZeroCloud can address one of the biggest MapReduce computational issues, that is data locality.</p>

<p>In addition to MapReduce type workloads, what else can one do? One could couple ElasticSeach and Log Stash, and indeed serve Kibana directly from Zero Cloud. Video trans-coding is another use case that I&rsquo;ve seen.</p>

<p>ZeroVM/ZeroCloud then, works well when you have a data heavy workload that would benefit being attacked in a distributed fashion.</p>

<h2 id="toc_3">Summary</h2>

<p>In this post we introduced you to ZeroCloud, the amalgamation of ZeroVM and OpenStack Swift. We dove into the architecture of ZeroCloud and introduced some use cases where having programmable distributed storage system is insanely useful.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-22-ZeroVM---Getting-Started-with-ZeroCloud'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-21-ZeroVM---IO--Channels'> ZeroVM - IO Operations in ZeroVM</a> </h2>
      <div class="meta">Tue, Oct 21, 2014</div>
    </header>

    

<p>If you are just joining these posts, you might want to take a few minutes and review these other posts on ZeroVM:</p>

<ul>
<li><a href="http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background">Background</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO">Isolation</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again/">Getting Started with ZeroVM</a></li>
<li><a href="http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump">Lots of ZeroVM Resources</a></li>
</ul>

<h2 id="toc_0">IO Operations in ZeroVM</h2>

<p>IO in ZeroVM is an odd sort of beast. As you are not working in a container or a VM you do not inherit the unlimited read/write to arbirtrary places as you would have otherwise. Instead the abstraction unit for ZeroVM is the <em>channel</em>.</p>

<h3 id="toc_1">Channels</h3>

<p>As the intro said, a <em>channel</em> is the unit of IO abstraction within ZeroVM. That means any network communication, any file write, any input from a pipe, or output to swift, each is an individual channel.</p>

<p>Additionally, channels have to be explicitly defined prior to launching a ZeroVM instance. In some ways, this is like specifying the VMDK for a traditional VM to boot from. The requirement to specify all channels before hand does provide a powerful security mechanism in that all IO is effectively sandboxed. An erroneous process can not cause damage outside of the narrow constraints defined within said channel.</p>

<p>Channels in ZeroVM are unique in other ways. Each channel, regardless of type, is presented to the instance as a file handle.</p>

<h3 id="toc_2">Channel Quotas</h3>

<p>To keep with the security and isolation provided within ZeroVM, along with the explicit channel definition, one must also specify a quota for IO. You specify said quota with four bits of information: (1) Total reads; (2) Total writes; (3) Total Read Size; and (4) Total Write Size.</p>

<p>Quotas are handled on a &lsquo;first one hit&rsquo; basis. So, if you have 10,000 reads to do, but said number of reads exceeds the total read size in bytes at read number 3,500, well, that&rsquo;s it. No more reads for you. The inverse of this is also true, when you run out of the number of allowed reads or writes before you hit the size quota, you will also get a failure returned.</p>

<p>When you do hit this limit, however, ZeroVM tries to fail gracefully, in that you will still have all the data read or written up to that point. Below is an example of what happens when you exceed the number of available reads:</p>

<pre><code>$ dd if=/dev/urandom of=/home/vagrant/file.txt bs=1048576 count=100

$ cat &gt; /home/vagrant/example.py &lt;&lt;EOF
file = open('/dev/3.file.txt', 'r')
print file.read(5)
EOF

$ su - vagrant -c &quot;zvsh --zvm-save-dir ~/ --zvm-image python.tar --zvm-image ~/file.txt python @example.py&quot;

$ sudo sed -i &quot;s|Channel = /home/vagrant/file.txt,/dev/3.file.txt,3,0,4294967296,4294967296,0,0|Channel = /home/vagrant/file.txt,/dev/3.file.txt,3,0,3,3,3,3|g&quot; /home/vagrant/manifest.1
$ sudo sed -i &quot;s|/home/vagrant/stdout.1|/dev/stdout|g&quot; /home/vagrant/manifest.1
$ sudo sed -i &quot;s|/home/vagrant/stderr.1|/dev/stderr|g&quot; /home/vagrant/manifest.1

$ zerovm -t 2 manifest.1

Traceback (most recent call last):
  File &quot;/dev/1.example.py&quot;, line 2, in &lt;module&gt;
    print file.read(5)
IOError: [Errno -122] Unknown error 4294967174
</code></pre>

<p>What is happening in that example is this:</p>

<p><strong>1.</strong> Create a 100MB file full of random bits</p>

<p><strong>2.</strong> Create &lsquo;example.py&rsquo; to read the first 5 characters in the file</p>

<p><strong>3.</strong> Use zvsh to run example.py inside ZeroVM&hellip; this should dump some garbage characters to the console.</p>

<p><strong>4.</strong> Change the quota from &lsquo;huge&rsquo; to 3</p>

<p><strong>5.</strong> Adjust the manifest file to allow stderr and stdout to work properly</p>

<p><strong>6.</strong> Run ZeroVM with the updated manifest &amp; receive IO error</p>

<h3 id="toc_3">Specifying Channels in a Manifest File</h3>

<p>So that example took me way too long to figure out. Mostly due to a few small things and one big one: Creating the manifest file properly. What follows is a quick way to create a manifest file as well as our example manifest and a breakdown thereof.</p>

<h4 id="toc_4">Creating a Manifest File</h4>

<p>It turns out that the zvsh utility that is bundled with ZeroVM has the ability to save the manifest (and other runtime files) when you launch it. To generate the template manifest that is used and modified in this example, run the following command:</p>

<pre><code>zvsh --zvm-save-dir ~/ --zvm-image python.tar --zvm-image ~/file.txt python @example.py
</code></pre>

<h4 id="toc_5">Breakdown of the Manifest File</h4>

<p>The example file that follows was for the specific bits used in our example. It can, however, make for a good starting point for your own manifest files.</p>

<pre><code>Node = 1
Version = 20130611
Timeout = 50
Memory = 4294967296,0
Program = /home/vagrant/boot.1
Channel = /dev/stdin,/dev/stdin,0,0,4294967296,4294967296,0,0
Channel = /dev/stdout,/dev/stdout,0,0,0,0,4294967296,4294967296
Channel = /dev/stderr,/dev/stderr,0,0,0,0,4294967296,4294967296
Channel = /home/vagrant/example.py,/dev/1.example.py,3,0,4294967296,4294967296,0,0
Channel = /home/vagrant/python.tar,/dev/2.python.tar,3,0,4294967296,4294967296,0,0
Channel = /home/vagrant/file.txt,/dev/3.file.txt,3,0,3,3,3,3
Channel = /home/vagrant/boot.1,/dev/self,3,0,4294967296,4294967296,0,0
Channel = /home/vagrant/nvram.1,/dev/nvram,3,0,4294967296,4294967296,4294967296,4294967296
</code></pre>

<p>Taken line by line:</p>

<p><strong>1.</strong> <strong>Node</strong> an optional parameter specifying the node number.</p>

<p><strong>2.</strong> <strong>Version</strong> mandatory. As manifest versions are incompatible. This tells both ZeroVM and you which version of the manifest you are using.</p>

<p><strong>3.</strong> <strong>Timeout</strong> in seconds, is a mandatory parameter. This prevents long running ZeroVM jobs from consuming excess resources.</p>

<p><strong>4.</strong> <strong>Memory</strong> Also mandatory, This is a comma separated value, where the first position is the 32-bit value representing memory. In our case, the max 4GB. The second number can be either 0 or 1 specifying the eTag used to checksum all data passing through ZeroVM</p>

<p><strong>5.</strong> <strong>Program</strong> Specifies the ZeroVM cross compiled binary that we will run</p>

<p><strong>6.</strong> <strong>Channel</strong> The channel definitions, these follow the format:</p>

<pre><code>Channel = &lt;uri&gt;,&lt;alias&gt;,&lt;type&gt;,&lt;etag&gt;,&lt;gets&gt;,&lt;get_size&gt;,&lt;puts&gt;,&lt;put_size&gt;
</code></pre>

<h2 id="toc_6">Summary</h2>

<p>In this post we covered how IO is handled in ZeroVM. We first explained the Channel concept, how quotas are handled within channels, and finally, how to add a channel or channels at ZeroVM runtime using a manifest.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-21-ZeroVM---IO--Channels'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump'> ZeroVM Link Dump</a> </h2>
      <div class="meta">Mon, Oct 20, 2014</div>
    </header>

    

<p>Instead of curating my own links this time, my friend and colleague <a href="http://cczona.com">Carina C. Zona, ZeroVM&rsquo;s community manager</a> has gathered these as they relate to ZeroVM:</p>

<h2 id="toc_0">Posts by Lars</h2>

<ul>
<li><a href="https://www.packtpub.com/books/content/mapreduce-openstack-swift-and-zerovm">https://www.packtpub.com/books/content/mapreduce-openstack-swift-and-zerovm</a></li>
<li><a href="https://www.packtpub.com/books/content/zerovm-virtualization-designed-cloud">https://www.packtpub.com/books/content/zerovm-virtualization-designed-cloud</a></li>
</ul>

<h2 id="toc_1">&ldquo;ZeroVM Architecture and ZVM Runtime (ZRT)&rdquo;</h2>

<p>Ryan McKinney at University of Texas San Antonio Cloud &amp; Big Data Laboratory [2014-08-05]
- <a href="http://www.slideshare.net/sgt_mac/zero-vm-architecture">slides (work in progress)</a></p>

<h2 id="toc_2">&ldquo;Changing the World with ZeroVM and Swift&rdquo;</h2>

<p>Jakub Krajcovic at PyConAU OpenStack Miniconf [2014-08-01]
- <a href="https://www.youtube.com/watch?v=e8Jui4EQbB8&amp;list=UUS9sdEyduD9K83K3GkvQlOA">video</a>
- <a href="http://www.slideshare.net/jakubk/changing-the-world-with-zerovm-and-swift">slides</a>
- <a href="http://sites.rcbops.com/openstack_miniconf/2014/07/openstack-miniconf-programme-for-pycon-au/">abstract</a></p>

<h2 id="toc_3">&ldquo;Deep Dive into ZeroVM&rdquo;</h2>

<p>Van Lindberg at OSCON Expo [2014-07-23]
- <em>(materials unavailable)</em></p>

<h2 id="toc_4">&ldquo;What Is ZeroVM?&rdquo;</h2>

<p>Carina C. Zona at OSCON Expo [2014-07-22]
- <a href="http://www.slideshare.net/cczona/what-is-zerovm">slides</a></p>

<h2 id="toc_5">&ldquo;ZeroVM: Virtualization for the Cloud&rdquo;</h2>

<p>Lars Butler at EuroPython [2014-07-21]
- <a href="https://www.youtube.com/watch?v=_a-aMMCSExM&amp;t=32m55s">video</a></p>

<h2 id="toc_6">&ldquo;Introduction to ZeroVM&rdquo;</h2>

<p>Muharem Jrnjadovic at Open Cloud Day [2014-07]
- <a href="http://player.mashpedia.com/player.php?q=12biEPjZFgY">video</a></p>

<h2 id="toc_7">&ldquo;NoSQL - Computable Object Store with OpenStack Swift and ZeroVM&rdquo;</h2>

<p>(aka &ldquo;Programmable Object Store with OpenStack Swift and ZeroVM&rdquo;)
Adrian Otto at BigDataCamp [2014-06-14]
- <a href="https://www.youtube.com/watch?v=VYZU_4w_dCA">video</a>
- <a href="http://1e1bd9b12a3230982c98-e2a0e10379dcd0e09ec354fba3ca6600.r72.cf1.rackcdn.com/ZeroCloud.pdf">slides</a>
- <a href="http://www.campsite.org/bigdatacampla/event/531/session/921">abstract</a></p>

<h2 id="toc_8">&ldquo;Using ZeroVM and Swift to Build a Compute Enabled Storage Platform&rdquo;</h2>

<p>Blake Yeager &amp; Camuel Gilydov at OpenStack Summit [2014-05-14]
- <a href="https://www.youtube.com/watch?v=oR1RUSdUQCs">video</a>
- <a href="https://www.openstack.org/assets/presentation-media/ZeroVM-and-OpenStack-Swift.pdf">slides</a></p>

<h2 id="toc_9">&ldquo;Using ZeroVM and Swift to Build a Compute Enabled Storage Platform&rdquo;</h2>

<p>Blake Yeager at Open BigCloud Symposium [2014-05-08]
- <em>(materials unavailable)</em></p>

<h2 id="toc_10">&ldquo;ZeroVM Background&rdquo;</h2>

<p>Prosunjit Biswas at University of Texas at San Antionio [UTSA] Institute of Cyber Security [2014-04-23]
- <a href="http://www.slideshare.net/prosunjit/zerovm-backgroud">slides</a></p>

<h2 id="toc_11">&ldquo;Process Virtualization with ZeroVM&rdquo;</h2>

<p>Jakub Krajcovi at rax.io [2014-02-26]
- <a href="http://www.slideshare.net/jakubk/how-to-revolutioniseanindustryraxio">slides</a></p>

<p>##&ldquo;ZeroVM Zwift: OpenStack Platform&rdquo;
Camuel Gilydov and Constantine Peresypkin at OpenStack Summit [2013-04]
- <a href="http://openstacksummitnovember2013.sched.org/event/6baa884625e0da79f8a0d582f0d600dc#.VDw-rb7FPIY">abstract</a></p>

<h2 id="toc_12">&ldquo;Big Data on OpenStack&rdquo;</h2>

<p>Camuel Gilydov at OpenStack Isreal [2012-06]
- <a href="https://www.youtube.com/watch?v=bbBunW0ms10">video</a></p>

<h2 id="toc_13">&ldquo;Containers or VMs: Which Virtualization Technology Works for You?&rdquo;</h2>

<p>Panel discussion with ZeroVM, Docker, and VMWare at while42 meetup [2014-03-04]
- <a href="https://www.youtube.com/watch?v=_Dm1KeC6VRI">video</a>
- <a href="https://www.eventbrite.com/e/meetnlearn-vm-or-containers-which-virtualization-techno-works-for-you-tickets-10666785643">info</a></p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again'> ZeroVM - Getting Started, Again</a> </h2>
      <div class="meta">Fri, Oct 17, 2014</div>
    </header>

    

<p>Ok, so now that we&rsquo;ve covered a LOT of ZeroVM background &amp; isolation details, let&rsquo;s actually start to get our hands dirty.</p>

<p>tl;dr - <code>git clone https://github.com/bunchc/vagrant-zerovm.git &amp;&amp; cd vagrant-zerovm &amp;&amp; vagrant up</code></p>

<h2 id="toc_0">Getting Started</h2>

<p>ZeroVM has packages for Ubuntu 12.04, so in order to get started you will either need hardware with 12.04 installed or a VM of the same. Once you have a VM up and running you are ready to install.</p>

<h2 id="toc_1">Installing ZeroVM</h2>

<p>To install ZeroVM, log into your Ubuntu 12.04 setup and run the following commands:</p>

<p>Install some needed packages:</p>

<pre><code>sudo apt-get update
sudo apt-get install -y curl wget
</code></pre>

<p>Install the ZeroVM repository and key:</p>

<pre><code>sudo su -c 'echo &quot;deb http://packages.zerovm.org/apt/ubuntu/ precise main&quot; &gt; /etc/apt/sources.list.d/zerovm-precise.list' 
wget -O- http://packages.zerovm.org/apt/ubuntu/zerovm.pkg.key | sudo apt-key add - 
</code></pre>

<p>Next, refresh our repository and install ZeroVM.</p>

<pre><code>sudo apt-get update
sudo apt-get install -y zerovm zerovm-cli
</code></pre>

<p>With that, you have ZeroVM installed.</p>

<p>By itself that is not interesting, so let&rsquo;s show off a the Python version of &ldquo;Hello world&rdquo; run inside ZeroVM:</p>

<pre><code>wget http://packages.zerovm.org/zerovm-samples/python.tar 
echo 'print &quot;Hello&quot;' &gt; hello.py

zvsh --zvm-image python.tar python @hello.py 
</code></pre>

<p>The first command fetches a cPython which has been cross compiled to work in ZeroVM. Next we set up our example file and run it. There are some even more interesting examples if you head over the <a href="http://www.zerovm.org/download.html">ZeroVM download site.</a></p>

<h2 id="toc_2">Summary</h2>

<p>In this post, you setup an Ubuntu 12.04 machine, installed the ZeroVM apt repositories, and installed ZeroVM. Finally, you created a Python of hello world and ran that within your newly installed ZeroVM.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO'> ZeroVM - Isolation</a> </h2>
      <div class="meta">Thu, Oct 16, 2014</div>
    </header>

    

<p>Here we go with another post on ZeroVM. This time to help get you up to speed on how ZeroVM provides isolation. For a reminder of what ZeroVM is, how it is different than containers and other virtualization technologies, see my prior post <a href="http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background/">here</a>, or the ZeroVM docs <a href="http://docs.zerovm.org">here</a>.</p>

<h2 id="toc_0">Isolation</h2>

<p>The <a href="http://docs.zerovm.org/zerovm/isolation_security.html">ZeroVM site</a> itself doesn&rsquo;t say much on the isolation provided by ZeroVM. This is largely because it derives it&rsquo;s isolation through the use of the <a href="http://en.wikipedia.org/wiki/Google_Native_Client">Google NaCL project</a>. The tl;dr for NaCL, is that it requires applications be ported over to it&rsquo;s sandboxing environment, in which a subset of processor instructions are made available.</p>

<p>The sandbox environment provided by NaCL is a limited subset of processor instructions that prevent various syscalls that could be destructive. Further, ZeroVM takes the 50 syscalls available in NaCL and reduces that to six. Meaning, if your code contains a syscall other than one of the six currently allowed, your code will fail when ZeroVM attempts to execute the specific syscall. The six syscalls allowed are currently:</p>

<ul>
<li>pread</li>
<li>pwrite</li>
<li>jail</li>
<li>unjail</li>
<li>fork</li>
<li>exit</li>
</ul>

<p>We can test this by trying an invalid write instead of pwrite with the following C++</p>

<pre><code>#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;

int main()
{
    char data[128];

    if(read(0, data, 128) &lt; 0)
     write(2, &quot;An error occurred in the read.\n&quot;, 31);

}
</code></pre>

<p>This is what it looks like when it implodes:</p>

<pre><code>$ zvsh syscalls
----------/tmp/tmpl7Mi1v----------
Node = 1
Version = 20130611
Timeout = 50
Memory = 4294967296, 0
Program = /home/vagrant/syscalls/syscalls
Channel = /dev/stdin,/dev/stdin,0,0,4294967296,4294967296,0,0
Channel = /tmp/tmpOfgnG6/stdout,/dev/stdout,0,0,0,0,4294967296,4294967296
Channel = /tmp/tmpOfgnG6/stderr,/dev/stderr,0,0,0,0,4294967296,4294967296
Channel = /tmp/tmpeNIzx4,/dev/nvram,3,0,4294967296,4294967296,4294967296,4294967296
-------------------------
----------/tmp/tmpeNIzx4----------
[args]
args = syscalls
[mapping]
channel=/dev/stdin,mode=char
channel=/dev/stdout,mode=char
channel=/dev/stderr,mode=char

-------------------------
2
0
0
disable
0.00 0.00 0 0 0 0 0 0 0 0
src/loader/elf_util.c 178: Segment 0 is of unexpected type 0x6, flag 0x5

ERROR: ZeroVM return code is 8
</code></pre>

<p>What is important here, at least in terms of telling why it failed is: <code>ERROR: ZeroVM return code is 8</code>. Error codes 1 - 17 indicate an issue in untrusted code. In our example, it was specifically the read / write bits that caused the issue.</p>

<h2 id="toc_1">Down The Rabbit Hole</h2>

<p>Time to jump down the rabbit hole. Into what actually just happened. First some diagrams:</p>

<h3 id="toc_2">ZeroVM Stack</h3>

<p>In this first diagram, you are looking at the internal structure of the ZeroVM process.
<img src="http://openstack.prov12n.com/screens/ZeroVM-Architecture-Design-Overview.pdf_2014-10-13_15-14-18.jpg" alt="ZVM Trusted Code Base Architecture" />
</p>

<p>Working from the outside in, the grey area represents everything that is ZeroVM, all of it&rsquo;s runtime data, IO Channels, virtual file systems, and most importantly, the user code to be executed.</p>

<p>Next, in the pink area is where end-user code gets loaded up, from there a call will progress down the stack. In the last white layer you can see the individual sys-calls as implemented in ZeroVM as well as their corresponding trappings.</p>

<p>One last thing to note is the two sys-calls for zvm_pread and zvm_pwrite, their traps, handlers, and this thing called a trampoline. The trampolines are a mechanisim that facilitates the switch from untrusted to trusted execution. A syscall will start in the &lsquo;untrusted&rsquo; context, if it is an allowed call, the ZRT or ZeroVM Run Time via it&rsquo;s hooks into the ZVM Syscall API and passes the call to a &ldquo;trampoline&rdquo; to perform the context switch needed to allow the syscall to execute in trusted space.</p>

<h3 id="toc_3">ZeroVM Guest Memory Footprint</h3>

<p>This next diagram offers a different view on the above ZeroVM guest. In the below diagram, you will see how the NaCL &amp; ZeroVM <em>trampolines</em> are implemented in memory, how that in turn gets passed down to the corresponding syscall, the trusted ELF binary, and where the rest of ZeroVM is contained.</p>

<p><img src="http://openstack.prov12n.com/screens/ZeroVM-Architecture-Design-Overview.pdf_2014-10-13_15-18-27.jpg" alt="Anatomy of the ZeroVM Guest Memory footprint" />
</p>

<h2 id="toc_4">Summary</h2>

<p>In this post, we took a deeper look into how isolation is handled within ZeorVM. We started with a high level discussion of NaCL and ZeroVM&rsquo;s implementation of limited syscalls. We then attempted to execute an invalid syscall. Finally we got into the nitty gritty of how that syscall is trapped via the ZeroVM runtime and where in it&rsquo;s memory stack context switches from trusted to untrusted code happen.</p>

<h2 id="toc_5">Resources</h2>

<ul>
<li><a href="https://docs.google.com/viewer?a=v&amp;pid=forums&amp;srcid=MDM5MTg3MTAwNDAwMTI4Njc5NzkBMTUyNDg3NTk2NDczMTE1MDYyMTIBcENUQTliQjJwSXNKATAuMQEBdjI">Diagrams from ZeroVM G+ Group</a></li>
<li><a href="http://www.slideshare.net/sgt_mac/zero-vm-architecture">ZeroVM Architecture Slideshare</a></li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background'> ZeroVM - Some Background</a> </h2>
      <div class="meta">Wed, Oct 15, 2014</div>
    </header>

    

<p>In a little over three weeks, at the <a href="https://www.openstack.org/summit/openstack-paris-summit-2014/">Paris Summit</a>, I&rsquo;ll be helping give a 90 minute workshop on <a href="http://zerovm.org/">ZeroVM</a>. 90 minutes is not actually a lot of time to get a good grasp on what ZeroVM is, how it operates, and most importantly, <em>why</em> it is important.</p>

<p>These next few posts however, I am hoping, will shed some light on that.</p>

<h2 id="toc_0">What is ZeroVM?</h2>

<p>From the ZeroVM website:</p>

<blockquote>
<p>ZeroVM is an open source virtualization technology that is based on the Chromium Native Client (NaCl) project. ZeroVM creates a secure and isolated execution environment which can run a single thread or application</p>
</blockquote>

<p>Read that over a few times. What it is saying, is where Docker provides packaging, traditional virtualization provides full OS isolation, ZeroVM provides an environment specific to a single application or thread.</p>

<p>Explained another way, ZeroVM provides isolation at the thread or application level. It provides a &ldquo;sandbox&rdquo; environment for you to run arbitrary &ldquo;untrusted&rdquo; code. Some examples of how this could be useful can be found <a href="http://play.golang.org/">here</a> and <a href="https://www.python.org/shell/">here</a>.</p>

<p>ZeroVM does this by using the <a href="http://en.wikipedia.org/wiki/Google_Native_Client">NaCL from Google</a> to provide isolation and security. ZeroVM also has a number of other layers to provide the additional services for things like a Posix file system, I/O, and channels.</p>

<h3 id="toc_1">Use Cases</h3>

<p>Due to the small size, speed, and isolation nature of ZeroVM, it is able to solve some problems which are very &ldquo;big data&rdquo; or cloud centric. Let&rsquo;s take a look at some:</p>

<ul>
<li><a href="http://incubator.apache.org/drill/">Apache Drill</a></li>
<li><a href="http://docs.zerovm.org/en/latest/zerocloud/overview.html">ZeroCloud</a>

<ul>
<li>More <a href="http://openstack.prov12n.com/getting-started-with-zerovm/">here</a></li>
</ul></li>
</ul>

<h2 id="toc_2">Where Does ZeroVM Fit?</h2>

<p>This diagram from the Atlanta OpenStack Summit should help:</p>

<p><img src="http://openstack.prov12n.com/screens/Using_ZeroVM_and_Swift_to_Build_a_Compute_Enabled_Storage_Platform_-_YouTube_2014-10-13_14-00-42.jpg" alt="ZeroVM vs Traditional Virt" />
</p>

<p>Additionally, <a href="https://www.youtube.com/watch?v=oR1RUSdUQCs#t=424">this</a> OpenStack Summit presentation should help clarify some as well.</p>

<h3 id="toc_3">Traditional Virtualization</h3>

<p>Traditional Virtualization is perhaps the easiest to cover, it&rsquo;s the most familiar way of isolating the things. I&rsquo;ve been running VMware Workstation/Fusion, their enterprise products, etc for <em>ages</em>. I imagine a lot of you have as well. To recap tho:</p>

<ul>
<li>Type 1 or 2 hypervisor</li>
<li>Each VM is a set of processes</li>
<li>CPU instructions virtualized (it&rsquo;s a bit more complicated now-a-days with Hardware extensions)</li>
<li>Carries around a full OS installation</li>
<li>All resources isolated</li>
<li>Very few <em>published</em> VM escapes</li>
</ul>

<p>A few clarifying points. I&rsquo;ve simplified the CPU conversation for this discussion. That is, while hardware extensions provide native or near native execution, there is still quite a bit happening in software for those instructions which do not translate. Additionally, the &ldquo;all resources isolated&rdquo; is a bit of a simplification as well. Most modern hypervisors will do some manner of memory sharing, compression, and consolidation. However, memory is still generally isolated to a specific VM.</p>

<h3 id="toc_4">Containers (Docker / LXC)</h3>

<p>Containers are all the rage these days. Docker has popularized and simplified the way we manage them. You get the same or better benefit from the shared hardware, however, containers strip quite a few of the layers:</p>

<ul>
<li>Shared Kernel / OS</li>
<li>Super low overhead</li>
<li>Fast startup</li>
<li>&lsquo;secure&rsquo;</li>
<li>Managed via namespaces and process isolation</li>
</ul>

<p>The important thing to note here, are the shared Kernel bits and the low overhead. The shared Kernel basically means everyone will run from the same Linux Kernel, and thus have the same features and limits therein. However, as an upside to that, you also shed having to carry around a full OS installation, networking stack, etc, and thus have much less overhead. This enables faster startup times.</p>

<h3 id="toc_5">ZeroVM</h3>

<p>Finally, and most important to what we&rsquo;re talking about is ZeroVM. ZeroVM is somewhere a bit beyond containers. That is you still have:</p>

<ul>
<li>Shared hardware</li>
<li>Low Overhead</li>
<li>Fast Startup</li>
</ul>

<p>However, you are no longer carrying an OS or Kernel around. In turn, this further minimizes the attack surface. That is, there are a total of 6 system calls available from within ZeroVM.</p>

<p>In addition, due to it&rsquo;s extremely small size one can spin up a new ZeroVM instance in miliseconds, vs seconds or minutes for the other technologies. This speed advantage lends itself well to one of ZeroVMs primary use cases in the data-pipeline / data-processing space. Indeed it is the magic that makes ZeroCloud work. It does, however, require a different way of thinking about and approaching the problem.</p>

<p>That is, ZeroVM instances are designed to be extremely temporary in nature. Load your data in, handle the processing, push it back out to disk and move on. Conceptually, it takes you a few steps further down the &lsquo;everything is disposable&rsquo; path, insofar as you will need to design and rewrite your apps to work with ZeroVM.</p>

<h2 id="toc_6">Summary</h2>

<p>While a wall of words, I hope I have provided some clarity around the what of ZeroVM and where it fits.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-14-Instance-Shelving'> Instance Shelving</a> </h2>
      <div class="meta">Tue, Oct 14, 2014</div>
    </header>

    

<p>Shelving? No no no, not that kind of shelving. Similar however. Image Shelving in Nova allows you to power off instances without experiencing the resource penalty in keeping them around.</p>

<h2 id="toc_0">Instance Shelving</h2>

<p>Before instance shelving in OpenStack, if a user powered down an instance, the resources would still be in use on the compute node that housed said instance. Quite wasteful, no? Say an instance is powered off for 72+ hours. Shelving allows you to keep all the various bits associated with the VM while moving it to somewhere that is not the hypervisor to conserve resources.</p>

<h2 id="toc_1">Working with Shelving</h2>

<p>The assumption here is that you have either devstack or some other flavor of OpenStack running. There isn&rsquo;t anything additional you need to configure to make this work.</p>

<p>First, let&rsquo;s log into our controller and look around at what&rsquo;s running:</p>

<pre><code># nova list
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status | Task State | Power State | Networks                                      |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | ACTIVE | -          | Running     | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
</code></pre>

<p>Next, let&rsquo;s shelve an instance:</p>

<pre><code># nova shelve test1
</code></pre>

<p>Did it get shelved?</p>

<pre><code># nova list
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status            | Task State | Power State | Networks                                      |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | SHELVED_OFFLOADED | -          | Shutdown    | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
</code></pre>

<p><strong>Note:</strong> The change in status to &ldquo;SHELVED_OFFLOADED&rdquo;</p>

<p>Now let&rsquo;s unshelve it &amp; check status:</p>

<pre><code># nova unshelve test1
# nova list
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status            | Task State | Power State | Networks                                      |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | SHELVED_OFFLOADED | spawning   | Shutdown    | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
</code></pre>

<p>There we go!</p>

<h2 id="toc_2">Summary</h2>

<p>In this post, we worked with one of the new-ish features in Nova, instance shelving. Good for when you need to stop instances for a long time in a non-impactful way.</p>

<h2 id="toc_3">References</h2>

<ul>
<li><a href="https://blueprints.launchpad.net/nova/+spec/shelve-instance">Blueprint</a></li>
<li><a href="http://docs.openstack.org/user-guide/content/shelve_server.html">OpenStack Docs</a></li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-14-Instance-Shelving'><nobr>Read more â†’</nobr></a>
    </footer>
</article>

              
            </ul>
          </section>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>



<div class="container content">
<footer>
  <div>
    <p class="right credit">
    Fancy footer here. Link to <a href="/">Home Page</a>
    </p>
  </div>
</footer>
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36732392-2', 'sglyon.com');
  ga('send', 'pageview');

</script>


</body>
</html>

