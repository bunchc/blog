

<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <base href="http://blog.codybunch.com">
    <title>blog.codybunch.com - The random msuings of an IT guy</title>
    <link rel="canonical" href="http://blog.codybunch.com/">
    <link href="http://blog.codybunch.com/index.xml" rel="alternate" type="application/rss+xml" title="blog.codybunch.com - The random msuings of an IT guy" />

    

<link rel="stylesheet" href="/css/poole.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/lanyon.css">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

</head>
  <body class="theme-base-08" lang="en">

  


<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    <a class="sidebar-nav-item" href="/posts">Blog</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014 Spencer Lyon. Powered by <a href="http://hugo.spf13.com">Hugo</a>. Design adapted from <a href="http://lanyon.getpoole.com">Lanyon</a>.
    </p>
  </div>
</div>


  
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Home</a>
          </h3>
        </div>
      </div>

      
      <div class="container content">
        <h1>This is a Blog</h1>

        
        <h2 class="post-title">Recent Posts</h2>
          <section id="main">
            <ul id="list">
              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump'> ZeroVM Link Dump</a> </h2>
      <div class="meta">Mon, Oct 20, 2014</div>
    </header>

    

<p>Instead of curating my own links this time, my friend and colleague <a href="http://twitter.com/cczona">Carina</a> has gathered these as they relate to ZeroVM:</p>

<h2 id="toc_0">&ldquo;ZeroVM Architecture and ZVM Runtime (ZRT)&rdquo;</h2>

<p>Ryan McKinney at University of Texas San Antonio Cloud &amp; Big Data Laboratory [2014-08-05]
- <a href="http://www.slideshare.net/sgt_mac/zero-vm-architecture">slides (work in progress)</a></p>

<h2 id="toc_1">&ldquo;Changing the World with ZeroVM and Swift&rdquo;</h2>

<p>Jakub Krajcovic at PyConAU OpenStack Miniconf [2014-08-01]
- <a href="https://www.youtube.com/watch?v=e8Jui4EQbB8&amp;list=UUS9sdEyduD9K83K3GkvQlOA">video</a>
- <a href="http://www.slideshare.net/jakubk/changing-the-world-with-zerovm-and-swift">slides</a>
- <a href="http://sites.rcbops.com/openstack_miniconf/2014/07/openstack-miniconf-programme-for-pycon-au/">abstract</a></p>

<h2 id="toc_2">&ldquo;Deep Dive into ZeroVM&rdquo;</h2>

<p>Van Lindberg at OSCON Expo [2014-07-23]
- <em>(materials unavailable)</em></p>

<h2 id="toc_3">&ldquo;What Is ZeroVM?&rdquo;</h2>

<p>Carina C. Zona at OSCON Expo [2014-07-22]
- <a href="http://www.slideshare.net/cczona/what-is-zerovm">slides</a></p>

<h2 id="toc_4">&ldquo;ZeroVM: Virtualization for the Cloud&rdquo;</h2>

<p>Lars Butler at EuroPython [2014-07-21]
- <a href="https://www.youtube.com/watch?v=_a-aMMCSExM&amp;t=32m55s">video</a></p>

<h2 id="toc_5">&ldquo;Introduction to ZeroVM&rdquo;</h2>

<p>Muharem Jrnjadovic at Open Cloud Day [2014-07]
- <a href="http://player.mashpedia.com/player.php?q=12biEPjZFgY">video</a></p>

<h2 id="toc_6">&ldquo;NoSQL - Computable Object Store with OpenStack Swift and ZeroVM&rdquo;</h2>

<p>(aka &ldquo;Programmable Object Store with OpenStack Swift and ZeroVM&rdquo;)
Adrian Otto at BigDataCamp [2014-06-14]
- <a href="https://www.youtube.com/watch?v=VYZU_4w_dCA">video</a>
- <a href="http://1e1bd9b12a3230982c98-e2a0e10379dcd0e09ec354fba3ca6600.r72.cf1.rackcdn.com/ZeroCloud.pdf">slides</a>
- <a href="http://www.campsite.org/bigdatacampla/event/531/session/921">abstract</a></p>

<h2 id="toc_7">&ldquo;Using ZeroVM and Swift to Build a Compute Enabled Storage Platform&rdquo;</h2>

<p>Blake Yeager &amp; Camuel Gilydov at OpenStack Summit [2014-05-14]
- <a href="https://www.youtube.com/watch?v=oR1RUSdUQCs">video</a>
- <a href="https://www.openstack.org/assets/presentation-media/ZeroVM-and-OpenStack-Swift.pdf">slides</a></p>

<h2 id="toc_8">&ldquo;Using ZeroVM and Swift to Build a Compute Enabled Storage Platform&rdquo;</h2>

<p>Blake Yeager at Open BigCloud Symposium [2014-05-08]
- <em>(materials unavailable)</em></p>

<h2 id="toc_9">&ldquo;ZeroVM Background&rdquo;</h2>

<p>Prosunjit Biswas at University of Texas at San Antionio [UTSA] Institute of Cyber Security [2014-04-23]
- <a href="http://www.slideshare.net/prosunjit/zerovm-backgroud">slides</a></p>

<h2 id="toc_10">&ldquo;Process Virtualization with ZeroVM&rdquo;</h2>

<p>Jakub Krajcovi at rax.io [2014-02-26]
- <a href="http://www.slideshare.net/jakubk/how-to-revolutioniseanindustryraxio">slides</a></p>

<p>##&ldquo;ZeroVM Zwift: OpenStack Platform&rdquo;
Camuel Gilydov and Constantine Peresypkin at OpenStack Summit [2013-04]
- <a href="http://openstacksummitnovember2013.sched.org/event/6baa884625e0da79f8a0d582f0d600dc#.VDw-rb7FPIY">abstract</a></p>

<h2 id="toc_11">&ldquo;Big Data on OpenStack&rdquo;</h2>

<p>Camuel Gilydov at OpenStack Isreal [2012-06]
- <a href="https://www.youtube.com/watch?v=bbBunW0ms10">video</a></p>

<h2 id="toc_12">&ldquo;Containers or VMs: Which Virtualization Technology Works for You?&rdquo;</h2>

<p>Panel discussion with ZeroVM, Docker, and VMWare at while42 meetup [2014-03-04]
- <a href="https://www.youtube.com/watch?v=_Dm1KeC6VRI">video</a>
- <a href="https://www.eventbrite.com/e/meetnlearn-vm-or-containers-which-virtualization-techno-works-for-you-tickets-10666785643">info</a></p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-20-ZeroVM-Link-Dump'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again'> ZeroVM - Getting Started, Again</a> </h2>
      <div class="meta">Fri, Oct 17, 2014</div>
    </header>

    

<p>Ok, so now that we&rsquo;ve covered a LOT of ZeroVM background &amp; isolation details, let&rsquo;s actually start to get our hands dirty.</p>

<p>tl;dr - <code>git clone https://github.com/bunchc/vagrant-zerovm.git &amp;&amp; cd vagrant-zerovm &amp;&amp; vagrant up</code></p>

<h2 id="toc_0">Getting Started</h2>

<p>ZeroVM has packages for Ubuntu 12.04, so in order to get started you will either need hardware with 12.04 installed or a VM of the same. Once you have a VM up and running you are ready to install.</p>

<h2 id="toc_1">Installing ZeroVM</h2>

<p>To install ZeroVM, log into your Ubuntu 12.04 setup and run the following commands:</p>

<p>Install some needed packages:</p>

<pre><code>sudo apt-get update
sudo apt-get install -y curl wget
</code></pre>

<p>Install the ZeroVM repository and key:</p>

<pre><code>sudo su -c 'echo &quot;deb http://packages.zerovm.org/apt/ubuntu/ precise main&quot; &gt; /etc/apt/sources.list.d/zerovm-precise.list' 
wget -O- http://packages.zerovm.org/apt/ubuntu/zerovm.pkg.key | sudo apt-key add - 
</code></pre>

<p>Next, refresh our repository and install ZeroVM.</p>

<pre><code>sudo apt-get update
sudo apt-get install -y zerovm zerovm-cli
</code></pre>

<p>With that, you have ZeroVM installed.</p>

<p>By itself that is not interesting, so let&rsquo;s show off a the Python version of &ldquo;Hello world&rdquo; run inside ZeroVM:</p>

<pre><code>wget http://packages.zerovm.org/zerovm-samples/python.tar 
echo 'print &quot;Hello&quot;' &gt; hello.py

zvsh --zvm-image python.tar python @hello.py 
</code></pre>

<p>The first command fetches a cPython which has been cross compiled to work in ZeroVM. Next we set up our example file and run it. There are some even more interesting examples if you head over the <a href="http://www.zerovm.org/download.html">ZeroVM download site.</a></p>

<h2 id="toc_2">Summary</h2>

<p>In this post, you setup an Ubuntu 12.04 machine, installed the ZeroVM apt repositories, and installed ZeroVM. Finally, you created a Python of hello world and ran that within your newly installed ZeroVM.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-17-ZeroVM---Getting-Started-Again'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO'> ZeroVM - Isolation</a> </h2>
      <div class="meta">Thu, Oct 16, 2014</div>
    </header>

    

<p>Here we go with another post on ZeroVM. This time to help get you up to speed on how ZeroVM provides isolation. For a reminder of what ZeroVM is, how it is different than containers and other virtualization technologies, see my prior post <a href="http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background/">here</a>, or the ZeroVM docs <a href="http://docs.zerovm.org/zerovm">here</a>.</p>

<h2 id="toc_0">Isolation</h2>

<p>The <a href="http://docs.zerovm.org/zerovm/isolation_security.html">ZeroVM site</a> itself doesn&rsquo;t say much on the isolation provided by ZeroVM. This is largely because it derives it&rsquo;s isolation through the use of the <a href="http://en.wikipedia.org/wiki/Google_Native_Client">Google NaCL project</a>. The tl;dr for NaCL, is that it requires applications be ported over to it&rsquo;s sandboxing environment, in which a subset of processor instructions are made available.</p>

<p>The sandbox environment provided by NaCL is a limited subset of processor instructions that prevent various syscalls that could be destructive. Further, ZeroVM takes the 50 syscalls available in NaCL and reduces that to six. Meaning, if your code contains a syscall other than one of the six currently allowed, your code will fail when ZeroVM attempts to execute the specific syscall. The six syscalls allowed are currently:</p>

<ul>
<li>pread</li>
<li>pwrite</li>
<li>jail</li>
<li>unjail</li>
<li>fork</li>
<li>exit</li>
</ul>

<p>We can test this by trying an invalid write instead of pwrite with the following C++</p>

<pre><code>#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;

int main()
{
    char data[128];

    if(read(0, data, 128) &lt; 0)
     write(2, &quot;An error occurred in the read.\n&quot;, 31);

}
</code></pre>

<p>This is what it looks like when it implodes:</p>

<pre><code>$ zvsh syscalls
----------/tmp/tmpl7Mi1v----------
Node = 1
Version = 20130611
Timeout = 50
Memory = 4294967296, 0
Program = /home/vagrant/syscalls/syscalls
Channel = /dev/stdin,/dev/stdin,0,0,4294967296,4294967296,0,0
Channel = /tmp/tmpOfgnG6/stdout,/dev/stdout,0,0,0,0,4294967296,4294967296
Channel = /tmp/tmpOfgnG6/stderr,/dev/stderr,0,0,0,0,4294967296,4294967296
Channel = /tmp/tmpeNIzx4,/dev/nvram,3,0,4294967296,4294967296,4294967296,4294967296
-------------------------
----------/tmp/tmpeNIzx4----------
[args]
args = syscalls
[mapping]
channel=/dev/stdin,mode=char
channel=/dev/stdout,mode=char
channel=/dev/stderr,mode=char

-------------------------
2
0
0
disable
0.00 0.00 0 0 0 0 0 0 0 0
src/loader/elf_util.c 178: Segment 0 is of unexpected type 0x6, flag 0x5

ERROR: ZeroVM return code is 8
</code></pre>

<p>What is important here, at least in terms of telling why it failed is: <code>ERROR: ZeroVM return code is 8</code>. Error codes 1 - 17 indicate an issue in untrusted code. In our example, it was specifically the read / write bits that caused the issue.</p>

<h2 id="toc_1">Down The Rabbit Hole</h2>

<p>Time to jump down the rabbit hole. Into what actually just happened. First some diagrams:</p>

<h3 id="toc_2">ZeroVM Stack</h3>

<p>In this first diagram, you are looking at the internal structure of the ZeroVM process.
<img src="http://openstack.prov12n.com/screens/ZeroVM-Architecture-Design-Overview.pdf_2014-10-13_15-14-18.jpg" alt="ZVM Trusted Code Base Architecture" />
</p>

<p>Working from the outside in, the grey area represents everything that is ZeroVM, all of it&rsquo;s runtime data, IO Channels, virtual file systems, and most importantly, the user code to be executed.</p>

<p>Next, in the pink area is where end-user code gets loaded up, from there a call will progress down the stack. In the last white layer you can see the individual sys-calls as implemented in ZeroVM as well as their corresponding trappings.</p>

<p>One last thing to note is the two sys-calls for zvm_pread and zvm_pwrite, their traps, handlers, and this thing called a trampoline. The trampolines are a mechanisim that facilitates the switch from untrusted to trusted execution. A syscall will start in the &lsquo;untrusted&rsquo; context, if it is an allowed call, the ZRT or ZeroVM Run Time traps the call, and uses the trampoline to perform the context switch needed to allow the syscall to execute in trusted space.</p>

<h3 id="toc_3">ZeroVM Guest Memory Footprint</h3>

<p>This next diagram offers a different view on the above ZeroVM guest. In the below diagram, you will see how the NaCL &amp; ZeroVM <em>trampolines</em> are implemented in memory, how that in turn gets passed down to the corresponding syscall, the trusted ELF binary, and where the rest of ZeroVM is contained.</p>

<p><img src="http://openstack.prov12n.com/screens/ZeroVM-Architecture-Design-Overview.pdf_2014-10-13_15-18-27.jpg" alt="Anatomy of the ZeroVM Guest Memory footprint" />
</p>

<h2 id="toc_4">Summary</h2>

<p>In this post, we took a deeper look into how isolation is handled within ZeorVM. We started with a high level discussion of NaCL and ZeroVM&rsquo;s implementation of limited syscalls. We then attempted to execute an invalid syscall. Finally we got into the nitty gritty of how that syscall is trapped via the ZeroVM runtime and where in it&rsquo;s memory stack context switches from trusted to untrusted code happen.</p>

<h2 id="toc_5">Resources</h2>

<ul>
<li><a href="https://docs.google.com/viewer?a=v&amp;pid=forums&amp;srcid=MDM5MTg3MTAwNDAwMTI4Njc5NzkBMTUyNDg3NTk2NDczMTE1MDYyMTIBcENUQTliQjJwSXNKATAuMQEBdjI">Diagrams from ZeroVM G+ Group</a></li>
<li><a href="http://www.slideshare.net/sgt_mac/zero-vm-architecture">ZeroVM Architecture Slideshare</a></li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-16-ZeroVM---Security-Isolation-and-IO'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background'> ZeroVM - Some Background</a> </h2>
      <div class="meta">Wed, Oct 15, 2014</div>
    </header>

    

<p>In a little over three weeks, at the <a href="https://www.openstack.org/summit/openstack-paris-summit-2014/">Paris Summit</a>, I&rsquo;ll be helping give a 90 minute workshop on <a href="http://zerovm.org/">ZeroVM</a>. 90 minutes is not actually a lot of time to get a good grasp on what ZeroVM is, how it operates, and most importantly, <em>why</em> it is important.</p>

<p>These next few posts however, I am hoping, will shed some light on that.</p>

<h2 id="toc_0">What is ZeroVM?</h2>

<p>From the ZeroVM website:</p>

<blockquote>
<p>ZeroVM is an open source virtualization technology that is based on the Chromium Native Client (NaCl) project. ZeroVM creates a secure and isolated execution environment which can run a single thread or application</p>
</blockquote>

<p>Read that over a few times. What it is saying, is where Docker provides packaging, traditional virtualization provides full OS isolation, ZeroVM provides an environment specific to a single application or thread.</p>

<p>Explained another way, ZeroVM provides isolation at the thread or application level. It provides a &ldquo;sandbox&rdquo; environment for you to run arbitrary &ldquo;untrusted&rdquo; code. Some examples of how this could be useful can be found <a href="http://play.golang.org/">here</a> and <a href="https://www.python.org/shell/">here</a>.</p>

<p>ZeroVM does this by using the <a href="http://en.wikipedia.org/wiki/Google_Native_Client">NaCL from Google</a> to provide isolation and security. ZeroVM also has a number of other layers to provide the additional services for things like a Posix file system, I/O, and channels.</p>

<h3 id="toc_1">Use Cases</h3>

<p>Due to the small size, speed, and isolation nature of ZeroVM, it is able to solve some problems which are very &ldquo;big data&rdquo; or cloud centric. Let&rsquo;s take a look at some:</p>

<ul>
<li><a href="http://incubator.apache.org/drill/">Apache Drill</a></li>
<li><a href="http://docs.zerovm.org/en/latest/zerocloud/overview.html">ZeroCloud</a>

<ul>
<li>More <a href="http://openstack.prov12n.com/getting-started-with-zerovm/">here</a></li>
</ul></li>
</ul>

<h2 id="toc_2">Where Does ZeroVM Fit?</h2>

<p>This diagram from the Atlanta OpenStack Summit should help:</p>

<p><img src="http://openstack.prov12n.com/screens/Using_ZeroVM_and_Swift_to_Build_a_Compute_Enabled_Storage_Platform_-_YouTube_2014-10-13_14-00-42.jpg" alt="ZeroVM vs Traditional Virt" />
</p>

<p>Additionally, <a href="https://www.youtube.com/watch?v=oR1RUSdUQCs#t=424">this</a> OpenStack Summit presentation should help clarify some as well.</p>

<h3 id="toc_3">Traditional Virtualization</h3>

<p>Traditional Virtualization is perhaps the easiest to cover, it&rsquo;s the most familiar way of isolating the things. I&rsquo;ve been running VMware Workstation/Fusion, their enterprise products, etc for <em>ages</em>. I imagine a lot of you have as well. To recap tho:</p>

<ul>
<li>Type 1 or 2 hypervisor</li>
<li>Each VM is a set of processes</li>
<li>CPU instructions virtualized (it&rsquo;s a bit more complicated now-a-days with Hardware extensions)</li>
<li>Carries around a full OS installation</li>
<li>All resources isolated</li>
<li>Very few <em>published</em> VM escapes</li>
</ul>

<p>A few clarifying points. I&rsquo;ve simplified the CPU conversation for this discussion. That is, while hardware extensions provide native or near native execution, there is still quite a bit happening in software for those instructions which do not translate. Additionally, the &ldquo;all resources isolated&rdquo; is a bit of a simplification as well. Most modern hypervisors will do some manner of memory sharing, compression, and consolidation. However, memory is still generally isolated to a specific VM.</p>

<h3 id="toc_4">Containers (Docker / LXC)</h3>

<p>Containers are all the rage these days. Docker has popularized and simplified the way we manage them. You get the same or better benefit from the shared hardware, however, containers strip quite a few of the layers:</p>

<ul>
<li>Shared Kernel / OS</li>
<li>Super low overhead</li>
<li>Fast startup</li>
<li>&lsquo;secure&rsquo;</li>
<li>Managed via namespaces and process isolation</li>
</ul>

<p>The important thing to note here, are the shared Kernel bits and the low overhead. The shared Kernel basically means everyone will run from the same Linux Kernel, and thus have the same features and limits therein. However, as an upside to that, you also shed having to carry around a full OS installation, networking stack, etc, and thus have much less overhead. This enables faster startup times.</p>

<h3 id="toc_5">ZeroVM</h3>

<p>Finally, and most important to what we&rsquo;re talking about is ZeroVM. ZeroVM is somewhere a bit beyond containers. That is you still have:</p>

<ul>
<li>Shared hardware</li>
<li>Low Overhead</li>
<li>Fast Startup</li>
</ul>

<p>However, you are no longer carrying an OS or Kernel around. In turn, this further minimizes the attack surface. That is, there are a total of 6 system calls available from within ZeroVM.</p>

<p>In addition, due to it&rsquo;s extremely small size one can spin up a new ZeroVM instance in miliseconds, vs seconds or minutes for the other technologies. This speed advantage lends itself well to one of ZeroVMs primary use cases in the data-pipeline / data-processing space. Indeed it is the magic that makes ZeroCloud work. It does, however, require a different way of thinking about and approaching the problem.</p>

<p>That is, ZeroVM instances are designed to be extremely temporary in nature. Load your data in, handle the processing, push it back out to disk and move on. Conceptually, it takes you a few steps further down the &lsquo;everything is disposable&rsquo; path, insofar as you will need to design and rewrite your apps to work with ZeroVM.</p>

<h2 id="toc_6">Summary</h2>

<p>While a wall of words, I hope I have provided some clarity around the what of ZeroVM and where it fits.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-15-ZeroVM---Some-Background'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-14-Instance-Shelving'> Instance Shelving</a> </h2>
      <div class="meta">Tue, Oct 14, 2014</div>
    </header>

    

<p>Shelving? No no no, not that kind of shelving. Similar however. Image Shelving in Nova allows you to power off instances without experiencing the resource penalty in keeping them around.</p>

<h2 id="toc_0">Instance Shelving</h2>

<p>Before instance shelving in OpenStack, if a user powered down an instance, the resources would still be in use on the compute node that housed said instance. Quite wasteful, no? Say an instance is powered off for 72+ hours. Shelving allows you to keep all the various bits associated with the VM while moving it to somewhere that is not the hypervisor to conserve resources.</p>

<h2 id="toc_1">Working with Shelving</h2>

<p>The assumption here is that you have either devstack or some other flavor of OpenStack running. There isn&rsquo;t anything additional you need to configure to make this work.</p>

<p>First, let&rsquo;s log into our controller and look around at what&rsquo;s running:</p>

<pre><code># nova list
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status | Task State | Power State | Networks                                      |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | ACTIVE | -          | Running     | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------------------------+
</code></pre>

<p>Next, let&rsquo;s shelve an instance:</p>

<pre><code># nova shelve test1
</code></pre>

<p>Did it get shelved?</p>

<pre><code># nova list
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status            | Task State | Power State | Networks                                      |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | SHELVED_OFFLOADED | -          | Shutdown    | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
</code></pre>

<p><strong>Note:</strong> The change in status to &ldquo;SHELVED_OFFLOADED&rdquo;</p>

<p>Now let&rsquo;s unshelve it &amp; check status:</p>

<pre><code># nova unshelve test1
# nova list
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| ID                                   | Name  | Status            | Task State | Power State | Networks                                      |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
| 05617907-3931-414f-88f3-fd180f69fde6 | test1 | SHELVED_OFFLOADED | spawning   | Shutdown    | cookbook_network_1=10.200.0.2, 192.168.100.11 |
+--------------------------------------+-------+-------------------+------------+-------------+-----------------------------------------------+
</code></pre>

<p>There we go!</p>

<h2 id="toc_2">Summary</h2>

<p>In this post, we worked with one of the new-ish features in Nova, instance shelving. Good for when you need to stop instances for a long time in a non-impactful way.</p>

<h2 id="toc_3">References</h2>

<ul>
<li><a href="https://blueprints.launchpad.net/nova/+spec/shelve-instance">Blueprint</a></li>
<li><a href="http://docs.openstack.org/user-guide/content/shelve_server.html">OpenStack Docs</a></li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-14-Instance-Shelving'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-13-Running-Rackspace-Private-Cloud-on-the-Rackspace-Public-Cloud'> Running Rackspace Private Cloud on the Rackspace Public Cloud</a> </h2>
      <div class="meta">Mon, Oct 13, 2014</div>
    </header>

    

<p>Private Cloud on the Public Cloud? As odd as that sounds, or as inception as it makes you feel (Clouds in clouds?!), I&rsquo;ve found that since downsizing my homelab quite a bit, I&rsquo;ve needed to find other ways to work on and try out various things that exceed the capacity of my laptop. RPC 9 is one of them.</p>

<p><strong>Disclaimer:</strong> I work for Rackspace, and while this post is largely focused around two of our products, I put it out here in the hopes that a) someone will find it useful, and b) it&rsquo;ll help me later.</p>

<h2 id="toc_0">Rackspace Private Cloud (RPC)</h2>

<p>Our docs will do it a lot more justice in terms of description than I can, so I encourage you to go <a href="http://docs.rackspace.com/rpc/api/v9/bk-rpc-installation/content/index.html">here</a> and take a few minutes to get familiar.</p>

<p>A few things I want to point out are related to the architecture of RPC9, specifically:</p>

<p><img src="http://docs.rackspace.com/rpc/api/v9/bk-rpc-installation/content/figures/1/a/a/a/rpc-common/figures/rpc9-environment-overview.png" alt="RPC Infrastructure" />
</p>

<p>Looking over the diagram, there are a <em>lot</em> of hosts involved now. 3x Infrastructure nodes, a logging host, n-Compute hosts, deployment hosts, and finally a set of load balancers. This thing is big. Bigger than my laptop that&rsquo;s for sure.</p>

<h2 id="toc_1">Running Cloud on Cloud</h2>

<p>Thankfully, however, while it&rsquo;s big, the folks who wrote this provided some OpenStack Heat templates that make setting it up externally much easier. Those can be found <a href="https://github.com/rcbops/ansible-lxc-rpc/tree/master/scripts">here.</a></p>

<h3 id="toc_2">Getting Started</h3>

<p>To build the cloud on the cloud you&rsquo;ll need the following info &amp; apps installed somewhere you have access to:</p>

<ul>
<li>An &ldquo;heatrc&rdquo; or similar file containing

<ul>
<li>Rackspace Username</li>
<li>Rackspace API Key</li>
<li>Endpoint(s) to deploy to</li>
</ul></li>
<li>Python-HeatClient</li>
<li>An SSH Key</li>
</ul>

<p>To create the &ldquo;heatrc&rdquo; file, start with the below template and then edit as needed:</p>

<pre><code>export OS_USERNAME=rackspace_cloud_username
export OS_PASSWORD=rackspace_cloud_password
export OS_TENANT_ID=rackspace_cloud_account_number
export OS_AUTH_URL=https://identity.api.rackspacecloud.com/v2.0/
export HEAT_URL=https://ord.orchestration.api.rackspacecloud.com/v1/${OS_TENANT_ID}
</code></pre>

<p><strong>Note:</strong> OS_TENANT_ID is your cloud account number. You can get to this by logging into mycloud.rackspace.com and clicking your account name in the upper right.</p>

<p>Once you&rsquo;ve created the file and replaced said values, install the Heat client: <code>pip install python-heatclient</code></p>

<h3 id="toc_3">Installing RPC 9 on the Rackspace Public Cloud</h3>

<p>To kick off the installation, follow these commands:</p>

<pre><code>curl https://raw.githubusercontent.com/rcbops/ansible-lxc-rpc/master/scripts/rpc9.0.0-aio-rax-heat-template.yml &gt; rpc9-rax-heat.yaml

source ./heatrc

heat stack-create RPC9-Stack -f ./rpc9-rax-heat.yaml \
  -P image_name=&quot;Ubuntu 14.04 LTS (Trusty Tahr)&quot; \
  -P ssh_key_name=&quot;lol_ssh_key&quot; \
  -P flavor_name=&quot;8 GB Performance&quot;

+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| c2b6c1b0-0098-441d-9999-c778b108a181 | RPC9-Stack | CREATE_IN_PROGRESS | 2014-10-13T15:13:58Z |
+--------------------------------------+------------+--------------------+----------------------+

</code></pre>

<p>This next part takes quite a bit of time to complete and is why we used a performance instance, to make the provision happen just a bit faster. You can keep an eye on it&rsquo;s build status with <code>watch -n 15 heat stack-list</code></p>

<p>Once it completes, you will need to find out what IP address it has been assigned, to do that, use these commands:</p>

<p>List the stacks:</p>

<pre><code>$ heat stack-list
+--------------------------------------+------------+-----------------+----------------------+
| id                                   | stack_name | stack_status    | creation_time        |
+--------------------------------------+------------+-----------------+----------------------+
| c2b6c1b0-0098-441d-9999-c778b108a181 | RPC9-Stack | CREATE_COMPLETE | 2014-10-13T15:13:58Z |
+--------------------------------------+------------+-----------------+----------------------+
</code></pre>

<p>List the available outputs:</p>

<pre><code>$ heat output-list RPC9-Stack
+------------------+-------------------------------------------------------+
| output_key       | description                                           |
+------------------+-------------------------------------------------------+
| RPCAIO_password  | The password for all the things.                      |
| RPCAIO_public_ip | The public IP address of the newly configured Server. |
+------------------+-------------------------------------------------------+
</code></pre>

<p>Finally show the IP:</p>

<pre><code>$ heat output-show RPC9-Stack RPCAIO_public_ip
&quot;127.0.0.100&quot;
</code></pre>

<h2 id="toc_4">Summary</h2>

<p>In this post we showed you how to nest the Rackspace Private Cloud installation on the Rackspace Public Cloud. A useful trick for testing it out without having to use <em>ALL</em> your local resources up.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-13-Running-Rackspace-Private-Cloud-on-the-Rackspace-Public-Cloud'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-10-OpenStack-Cookbook-3rd-Edition'> OpenStack Cookbook 3rd Edition</a> </h2>
      <div class="meta">Fri, Oct 10, 2014</div>
    </header>

    

<p>Oh Oh Oh! The lesson in book writing is that it is both terrible and addictive. That is, right as we wrapped the second edition of the OpenStack Cookbook, I promised myself &ldquo;Never again!&rdquo;.</p>

<p>Now, some number of months later, <a href="https://twitter.com/itarchitectkev">Kevin</a> and myself, we&rsquo;ve chatted a bit, and have decided to go down that road to update the book again. Indeed, we&rsquo;re also looking at bringing <a href="https://twitter.com/eglute">Egle</a> along for the ride this time.</p>

<h2 id="toc_0">3rd Edition Highlights</h2>

<p>The third edition will target either a late Juno or early Kilo release (Hooray Relevancy!). In addition to general updates, were adding or overhauling the following:</p>

<ul>
<li>OpenStack Datacenter Automation</li>
<li>OpenStack Scaling</li>
<li>Image Management &amp; Conversion</li>
<li>More Operations Recipes</li>
<li>HTTPS!</li>
<li>OpenStack Heat</li>
<li>Additional Neutron Services (LBaaS, VPNaaS)</li>
<li>Using 3rd Party drivers</li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-10-OpenStack-Cookbook-3rd-Edition'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-10-09-30-Posts-in-30-Days'> 30 Posts in 30 Days</a> </h2>
      <div class="meta">Thu, Oct 9, 2014</div>
    </header>

    <p>I found this morning I was in a bit of a blogging slump. That is, I&rsquo;d not posted anything in quite a while, even though I have plenty of exciting things going on at the moment. So, with that said, happening across <a href="http://etherealmind.com/challenge-30-blogs-30-days/">this post</a> by Greg Ferro (<a href="http://twitter.com/@etherealmind">@etherealmind</a>), I thought I&rsquo;d jump into the fray.</p>

<p>I encourage you to do the same.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-10-09-30-Posts-in-30-Days'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-09-12-Currently-Reading---Sept-2014'> Currently Reading - Sept 2014</a> </h2>
      <div class="meta">Fri, Sep 12, 2014</div>
    </header>

    <p>I&rsquo;ve found overtime my reading habbits have changed from mostly tech books to a fair mix of things, with some things that suprised even me&hellip; business books. o.O? Here&rsquo;s what&rsquo;s currently on my list and in progress, first the boring ones:</p>

<ul>
<li><a href="http://www.amazon.com/Curve-Freeloaders-Superfans-Future-Business-ebook/dp/B00C5R7B6W/ref=sr_1_1_bnp_1_kin?ie=UTF8&amp;qid=1410211612&amp;sr=8-1&amp;keywords=the+curve+how+smart+companies+find+high+value">The Curve: How Smart Companies Find High-Value Customers</a></li>
<li><a href="http://www.amazon.com/Thinking-Fast-Slow-Daniel-Kahneman-ebook/dp/B00555X8OA/ref=sr_1_1_bnp_1_kin?ie=UTF8&amp;qid=1410211622&amp;sr=8-1&amp;keywords=thinking+fast+and+slow">Thinking, Fast and Slow</a></li>
<li><a href="http://www.amazon.com/Vagrant-Up-Running-Mitchell-Hashimoto-ebook/dp/B00D3VH4IO">Vagrant: Up and Running</a></li>
<li><a href="http://www.amazon.com/Art-Learning-Journey-Pursuit-Excellence-ebook/dp/B000QCQ970/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546893&amp;sr=1-1&amp;keywords=the+art+of+learning">The Art of Learning</a></li>
<li><a href="http://www.amazon.com/SYSTEMANTICS-SYSTEMS-BIBLE-John-Gall-ebook/dp/B00AK1BIDM/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546946&amp;sr=1-1&amp;keywords=systemantics">Systemantics. The Systems Bible</a></li>
<li><a href="http://www.amazon.com/Essential-Drucker-Collins-Business-Essentials-ebook/dp/B000FC11LK/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546958&amp;sr=1-1&amp;keywords=essential+drucker">The Essential Drucker</a></li>
<li><a href="http://www.amazon.com/Pragmatism-Other-Writings-Penguin-Classics/dp/0140437355/ref=sr_1_1?ie=UTF8&amp;qid=undefined&amp;sr=8-1&amp;keywords=pragmatism+and+other+essays">Pragmatism and Other Writings</a></li>
<li><a href="http://markburgess.org/BookOfPromises.pdf">Book of Promises</a> Promise Theory!</li>
<li><a href="http://arxiv.org/pdf/0810.3294v5.pdf">A static Theory of Promises</a></li>
</ul>

<p>Then on the more fun side:</p>

<ul>
<li><a href="http://www.amazon.com/Brightness-Reef-Uplift-Trilogy-Book/dp/0553573306/ref=la_B000APAXV6_1_7?s=books&amp;ie=UTF8&amp;qid=1410547103&amp;sr=1-7">Brightness Reef</a> and the rest of said series.</li>
<li><a href="http://www.amazon.com/Gardens-Moon-Book-Malazan-Fallen-ebook/dp/B002KYHZLQ/ref=tmm_kin_swatch_0?_encoding=UTF8&amp;sr=1-3-fkmr0&amp;qid=1410547192">Gardens of the Moon: Book 1 of The Malazan Book of the Fallen</a> and the rest of that series.</li>
<li><a href="http://www.amazon.com/Geek-Dads-Guide-Weekend-Fun-ebook/dp/B004RKXO16/ref=sr_1_2?s=digital-text&amp;ie=UTF8&amp;qid=1410547255&amp;sr=1-2&amp;keywords=geek+dad">Geek Dad&rsquo;s Weekend Fun</a>, Doing a project every weekend or so.</li>
<li><a href="http://www.amazon.com/Echopraxia-Peter-Watts-ebook/dp/B00IHCBDJ0/ref=tmm_kin_swatch_0?_encoding=UTF8&amp;sr=&amp;qid=">Echopraxia</a></li>
</ul>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-09-12-Currently-Reading---Sept-2014'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
              

<article class="post">
    <header>
      <h2><a href='http://blog.codybunch.com/posts/2014-09-10-MariaDB-With-Galera-on-Vagrant'> MariaDB With Galera on Vagrant</a> </h2>
      <div class="meta">Wed, Sep 10, 2014</div>
    </header>

    

<p>Found myself in some training this last week using MariaDB, and being that I like to get a bit more hands on than most, using the class provided lab environment wasn&rsquo;t going to cut it. This meant wrapping some scripting into a Vagrant environment so I could reliably reporduce the three node lab.</p>

<h2 id="toc_0">Getting Started</h2>

<p>You&rsquo;ll need Vagrant and Git. It&rsquo;s also preferred that you have vagrant-cachier installed. You should have vagrant-cachier anyways, but alas, that is not for right now. Once you have these out of the way, do the following:</p>

<ol>
<li><code>git clone https://github.com/bunchc/mariadb-galera-vagrant.git</code></li>
<li><code>cd mariadb-galera-vagrant</code></li>
<li><code>vagrant up</code></li>
</ol>

<h2 id="toc_1">Validating the Cluster</h2>

<p>After a few minutes, you should be able to log into any of the nodes. Specifically, node-01 will be used to &lsquo;bootstrap&rsquo; the cluster, the other two nodes will join from there.</p>

<p>To validate the cluster:</p>

<pre><code>vagrant ssh mariadb-02
sudo su -
mysql -uroot
SHOW GLOBAL STATUS LIKE 'wsrep%';
</code></pre>

<p>You should be able to do the above from any of the nodes in the cluster.</p>

    <footer>
        <a href='http://blog.codybunch.com/posts/2014-09-10-MariaDB-With-Galera-on-Vagrant'><nobr>Read more →</nobr></a>
    </footer>
</article>

              
            </ul>
          </section>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>



<div class="container content">
<footer>
  <div>
    <p class="right credit">
    Fancy footer here. Link to <a href="/">Home Page</a>
    </p>
  </div>
</footer>
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36732392-2', 'sglyon.com');
  ga('send', 'pageview');

</script>


</body>
</html>

