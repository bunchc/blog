<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cody Bunch &middot; Some Random IT Guy - OpenStack, DevOps, Cloud, Things
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Offering all manner of technical how-to (and how not to) and other technical content. I specalize in OpenStack, VMware, and most things automation and cloud related.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Cody Bunch</a>
            <small>Some Random IT Guy - OpenStack, DevOps, Cloud, Things</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/10/OpenStack-Cookbook-3rd-Edition/">
        OpenStack Cookbook 3rd Edition
      </a>
    </h1>

    <span class="post-date">10 Oct 2014</span>

    <p>Oh Oh Oh! The lesson in book writing is that it is both terrible and addictive. That is, right as we wrapped the second edition of the OpenStack Cookbook, I promised myself &quot;Never again!&quot;.</p>

<p>Now, some number of months later, <a href="https://twitter.com/itarchitectkev">Kevin</a> and myself, we&#39;ve chatted a bit, and have decided to go down that road to update the book again. Indeed, we&#39;re also looking at bringing <a href="https://twitter.com/eglute">Egle</a> along for the ride this time.</p>

<h2>3rd Edition Highlights</h2>

<p>The third edition will target either a late Juno or early Kilo release (Hooray Relevancy!). In addition to general updates, were adding or overhauling the following:</p>

<ul>
<li>OpenStack Datacenter Automation</li>
<li>OpenStack Scaling</li>
<li>Image Management &amp; Conversion</li>
<li>More Operations Recipes</li>
<li>HTTPS!</li>
<li>OpenStack Heat</li>
<li>Additional Neutron Services (LBaaS, VPNaaS)</li>
<li>Using 3rd Party drivers</li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/09/30-Posts-in-30-Days/">
        30 Posts in 30 Days
      </a>
    </h1>

    <span class="post-date">09 Oct 2014</span>

    <p>I found this morning I was in a bit of a blogging slump. That is, I&#39;d not posted anything in quite a while, even though I have plenty of exciting things going on at the moment. So, with that said, happening across <a href="http://etherealmind.com/challenge-30-blogs-30-days/">this post</a> by Greg Ferro (<a href="http://twitter.com/@etherealmind">@etherealmind</a>), I thought I&#39;d jump into the fray.</p>

<p>I encourage you to do the same.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/09/12/Currently-Reading---Sept-2014/">
        Currently Reading - Sept 2014
      </a>
    </h1>

    <span class="post-date">12 Sep 2014</span>

    <p>I&#39;ve found overtime my reading habbits have changed from mostly tech books to a fair mix of things, with some things that suprised even me... business books. o.O? Here&#39;s what&#39;s currently on my list and in progress, first the boring ones:</p>

<ul>
<li><a href="http://www.amazon.com/Curve-Freeloaders-Superfans-Future-Business-ebook/dp/B00C5R7B6W/ref=sr_1_1_bnp_1_kin?ie=UTF8&amp;qid=1410211612&amp;sr=8-1&amp;keywords=the+curve+how+smart+companies+find+high+value">The Curve: How Smart Companies Find High-Value Customers</a></li>
<li><a href="http://www.amazon.com/Thinking-Fast-Slow-Daniel-Kahneman-ebook/dp/B00555X8OA/ref=sr_1_1_bnp_1_kin?ie=UTF8&amp;qid=1410211622&amp;sr=8-1&amp;keywords=thinking+fast+and+slow">Thinking, Fast and Slow</a></li>
<li><a href="http://www.amazon.com/Vagrant-Up-Running-Mitchell-Hashimoto-ebook/dp/B00D3VH4IO">Vagrant: Up and Running</a></li>
<li><a href="http://www.amazon.com/Art-Learning-Journey-Pursuit-Excellence-ebook/dp/B000QCQ970/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546893&amp;sr=1-1&amp;keywords=the+art+of+learning">The Art of Learning</a></li>
<li><a href="http://www.amazon.com/SYSTEMANTICS-SYSTEMS-BIBLE-John-Gall-ebook/dp/B00AK1BIDM/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546946&amp;sr=1-1&amp;keywords=systemantics">Systemantics. The Systems Bible</a></li>
<li><a href="http://www.amazon.com/Essential-Drucker-Collins-Business-Essentials-ebook/dp/B000FC11LK/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1410546958&amp;sr=1-1&amp;keywords=essential+drucker">The Essential Drucker</a></li>
<li><a href="http://www.amazon.com/Pragmatism-Other-Writings-Penguin-Classics/dp/0140437355/ref=sr_1_1?ie=UTF8&amp;qid=undefined&amp;sr=8-1&amp;keywords=pragmatism+and+other+essays">Pragmatism and Other Writings</a></li>
<li><a href="http://markburgess.org/BookOfPromises.pdf">Book of Promises</a> Promise Theory!</li>
<li><a href="http://arxiv.org/pdf/0810.3294v5.pdf">A static Theory of Promises</a></li>
</ul>

<p>Then on the more fun side:</p>

<ul>
<li><a href="http://www.amazon.com/Brightness-Reef-Uplift-Trilogy-Book/dp/0553573306/ref=la_B000APAXV6_1_7?s=books&amp;ie=UTF8&amp;qid=1410547103&amp;sr=1-7">Brightness Reef</a> and the rest of said series.</li>
<li><a href="http://www.amazon.com/Gardens-Moon-Book-Malazan-Fallen-ebook/dp/B002KYHZLQ/ref=tmm_kin_swatch_0?_encoding=UTF8&amp;sr=1-3-fkmr0&amp;qid=1410547192">Gardens of the Moon: Book 1 of The Malazan Book of the Fallen</a> and the rest of that series.</li>
<li><a href="http://www.amazon.com/Geek-Dads-Guide-Weekend-Fun-ebook/dp/B004RKXO16/ref=sr_1_2?s=digital-text&amp;ie=UTF8&amp;qid=1410547255&amp;sr=1-2&amp;keywords=geek+dad">Geek Dad&#39;s Weekend Fun</a>, Doing a project every weekend or so.</li>
<li><a href="http://www.amazon.com/Echopraxia-Peter-Watts-ebook/dp/B00IHCBDJ0/ref=tmm_kin_swatch_0?_encoding=UTF8&amp;sr=&amp;qid=">Echopraxia</a></li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/09/10/MariaDB-With-Galera-on-Vagrant/">
        MariaDB With Galera on Vagrant
      </a>
    </h1>

    <span class="post-date">10 Sep 2014</span>

    <p>Found myself in some training this last week using MariaDB, and being that I like to get a bit more hands on than most, using the class provided lab environment wasn&#39;t going to cut it. This meant wrapping some scripting into a Vagrant environment so I could reliably reporduce the three node lab.</p>

<h2>Getting Started</h2>

<p>You&#39;ll need Vagrant and Git. It&#39;s also preferred that you have vagrant-cachier installed. You should have vagrant-cachier anyways, but alas, that is not for right now. Once you have these out of the way, do the following:</p>

<ol>
<li><code>git clone https://github.com/bunchc/mariadb-galera-vagrant.git</code></li>
<li><code>cd mariadb-galera-vagrant</code></li>
<li><code>vagrant up</code></li>
</ol>

<h2>Validating the Cluster</h2>

<p>After a few minutes, you should be able to log into any of the nodes. Specifically, node-01 will be used to &#39;bootstrap&#39; the cluster, the other two nodes will join from there.</p>

<p>To validate the cluster:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">vagrant ssh mariadb-02
sudo su -
mysql -uroot
SHOW GLOBAL STATUS LIKE &#39;wsrep%&#39;;
</code></pre></div>
<p>You should be able to do the above from any of the nodes in the cluster.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/08/19/Raspberry-Pi-as-PXE-Server/">
        Raspberry Pi as PXE Server
      </a>
    </h1>

    <span class="post-date">19 Aug 2014</span>

    <p>As I start to move from OpenStack Compute Cells in Devstack to OpenStack Compute Cells physicall, I needed to re-think my homelab some. It had been running some variation of vsphere and the OpenStack Cookbook work from various projects prior. Basically, it was a Hodor of a home lab.</p>

<h2>Hodor!</h2>

<p>Rather than lose a bit of hardware to foreman, or one of the new razor forks (I may still go this route later), I decided instead to pound a Raspberry Pi into service. To turn the rPI into a usable provisioning server, I did the following:</p>

<ol>
<li>Provision a 16gb card with Raspbian</li>
<li>Beat Networking Into Submission</li>
<li>Setup IP Tables for Nat</li>
<li>Configure DHCP, PXE, TFTP, etc</li>
</ol>

<p>We&#39;ll skip step 1 as the folks at <a href="http://www.raspberrypi.org/">raspberrypi.org</a> cover that pretty well already.</p>

<h2>Beat Networking Into Submission</h2>

<p>So the rPI does some auto-hotplugging bits that can cause you some issues if you try to use both wifi and ethernet at the same time. If you&#39;re not expecting them, well... let&#39;s just say I spent too long trying to solve before googling the problem. Here&#39;s what my networking config files look like:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># cat /etc/network/interfaces
auto lo
iface lo inet loopback

auth eth0
allow-hotplug eth0
iface eth0 inet static
    address 172.16.0.1
    netmask 255.255.255.0

auto wlan0
allow-hotplug wlan0
iface wlan0 inet static
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
    address 10.0.1.15
    netmask 255.255.255.0
    broadcast 10.0.1.255
    gateway 10.0.1.1

iface default inet dhcp

# cat /etc/default/ifplugd
INTERFACES=&quot;eth0&quot;
HOTPLUG_INTERFACES=&quot;eth0&quot;
ARGS=&quot;-q -f -u0 -d10 -w -I&quot;
SUSPEND_ACTION=&quot;stop&quot;
</code></pre></div>
<p>Once you have that, reboot the rPI and you should be good to go.</p>

<h2>Setup IP Tables for NAT</h2>

<p>This is also pretty well straight forward, but for some reason I end up googling it each time. Here it is for reference:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># NAT
iptables --table nat --append POSTROUTING --out-interface wlan0 -j MASQUERADE
iptables --append FORWARD --in-interface eth0 -j ACCEPT
iptables-save | sudo tee /etc/iptables.conf
iptables-restore &lt; /etc/iptables.conf
sh -c &quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;
sed -i &quot;s/exit 0/iptables-restore &lt; \/etc\/\iptables.conf \nexit 0/g&quot; /etc/rc.local
sed -i &quot;s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g&quot; /etc/sysctl.conf
</code></pre></div>
<h2>Configure DHCP, PXE, TFTP, etc</h2>

<p>This one is a bit more involved, but is all done via the following bash commands:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MY_IP=$(ifconfig eth0 | awk &#39;/inet addr/ {split ($2,A,&quot;:&quot;); print A[2]}&#39;)

# Install the things
sudo apt-get install -y dnsmasq nfs-kernel-server syslinux-common

# Setup some shell folders
sudo mkdir -p /tftpboot/images/ubuntu/14.04/amd64
sudo cp -r /usr/lib/syslinux/* /tftpboot/
sudo mkdir -p /tftpboot/pxelinux.cfg/Ubuntu
sudo cp /usr/lib/syslinux/vesamenu.c32 /tftpboot/

# Create a pxe.conf file
sudo cat &gt; /tftpboot/pxelinux.cfg/pxe.conf &lt;&lt;EOF
MENU TITLE  PXE Server 
NOESCAPE 1
ALLOWOPTIONS 1
PROMPT 0
MENU WIDTH 80
MENU ROWS 14
MENU TABMSGROW 24
MENU MARGIN 10
MENU COLOR border               30;44      #ffffffff #00000000 std
EOF

# Create our PXE Menu
sudo cat &gt; /tftpboot/pxelinux.cfg/default &lt;&lt;EOF
DEFAULT vesamenu.c32 
TIMEOUT 600
ONTIMEOUT BootLocal
PROMPT 0
MENU INCLUDE pxelinux.cfg/pxe.conf
NOESCAPE 1
LABEL BootLocal
        localboot 0
        TEXT HELP
        Boot to local hard disk
        ENDTEXT
MENU BEGIN Ubuntu
MENU TITLE Ubuntu 
        LABEL Previous
        MENU LABEL Previous Menu
        TEXT HELP
        Return to previous menu
        ENDTEXT
        MENU EXIT
        MENU SEPARATOR
        MENU INCLUDE Ubuntu/Ubuntu.menu
MENU END
EOF

sudo cat &gt; /tftpboot/pxelinux.cfg/Ubuntu/Ubuntu.menu &lt;&lt;EOF
LABEL 2
        MENU LABEL Ubuntu 14.04 (64-bit)
        kernel tftp://$MY_IP/images/ubuntu/14.04/amd64/install/netboot/ubuntu-installer/amd64/linux
        append auto=true priority=critical vga=788 initrd=tftp://$MY_IP/images/ubuntu/14.04/amd64/install/netboot/ubuntu-installer/amd64/initrd.gz locale=en_US.UTF-8 kbd-chooser/method=us netcfg/choose_interface=auto url=tftp://172.16.11.250/preseed.cfg
        TEXT HELP
        Boot the Ubuntu 14.04 64-bit DVD
        ENDTEXT
EOF

# Configure dnsmasq for tftp &amp; dhcp
sudo cat &gt;&gt; /etc/dnsmasq.conf &lt;&lt;EOF
server=$MY_IP@eth0
interface=eth0
no-dhcp-interface=wlan0
dhcp-range=172.16.0.10,172.16.0.253,12h
dhcp-boot=pxelinux.0
pxe-service=x86PC,&quot;Booting from Network...&quot;,pxelinux
enable-tftp
tftp-root=/tftpboot
dhcp-boot=pxelinux.0,servername,$MY_IP
EOF
sudo service dnsmasq restart

# Get 14.04 and extract the needful
wget -O ~/ubuntu-14.04-server-amd64.iso http://mirror.anl.gov/pub/ubuntu-iso/CDs/trusty/ubuntu-14.04.1-server-amd64.iso

sudo mkdir /mnt/loop
sudo mount -o loop -t iso9660 ~/ubuntu-14.04-server-amd64.iso /mnt/loop
sudo cp -R /mnt/loop/* /tftpboot/images/ubuntu/14.04/amd64
sudo cp -R /mnt/loop/.disk /tftpboot/images/ubuntu/14.04/amd64
sudo umount /mnt/loop

# Get a generic preseed
wget -O /tftpboot/preseed.cfg https://help.ubuntu.com/lts/installation-guide/example-preseed.txt

# Setup NFS mounts
echo &quot;
/tftpboot/images/ubuntu/    *(ro,sync,no_subtree_check)&quot; | sudo tee -a /etc/exports

# Enable RPCBind, NFS, and restart them
update-rc.d rpcbind enable &amp;&amp; update-rc.d nfs-common enable
service rpcbind start
service nfs-kernel-server restart
</code></pre></div>
<p>The commands themselves are commented pretty well. Generically what they do is install dnsmasq for dhcp &amp; tftp. From there we download and extract all the things from the ISO that we&#39;ll need, configure some menus, download a basic preseed, and restart some services.</p>

<h2>Summary</h2>

<p>In this post, we took a lowly Raspberry Pi and indentured it into some network servitude as a pxe / tftp server. We did this by installing and configuring dnsmasq for tftp and dhcp. Additionally we set up some fancy pxeboot menus and configured them to boot locally as a priority and to the network in times of need. Finally, we pulled down an Ubuntu 14.04 image and generic preseed file to use for automatic installs.</p>

<h2>Resources</h2>

<ul>
<li><a href="http://raspberrypi.stackexchange.com/questions/8851/setting-up-wifi-and-ethernet">http://raspberrypi.stackexchange.com/questions/8851/setting-up-wifi-and-ethernet</a></li>
<li><a href="http://it-joe.com/howtos/pxe.php">http://it-joe.com/howtos/pxe.php</a></li>
<li><a href="http://wernerstrydom.com/2014/05/25/automatically-installing-ubuntu-server-14-04-tftp/">http://wernerstrydom.com/2014/05/25/automatically-installing-ubuntu-server-14-04-tftp/</a></li>
</ul>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page7">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page5">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
