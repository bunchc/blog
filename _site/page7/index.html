<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Cody Bunch &middot; Some Random IT Guy - OpenStack, DevOps, Cloud, Things
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Offering all manner of technical how-to (and how not to) and other technical content. I specalize in OpenStack, VMware, and most things automation and cloud related.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Cody Bunch</a>
            <small>Some Random IT Guy - OpenStack, DevOps, Cloud, Things</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/08/15/Vagrant-and-Hanlon-The-other-Razor-Fork/">
        Vagrant and Hanlon (The other Razor Fork)
      </a>
    </h1>

    <span class="post-date">15 Aug 2014</span>

    <p>You may or may not know that Razor, the bare-metal lifecycle tool, has forked from its original bits. This is a good thing, but it&#39;s still really early days on the new forks, so we&#39;ll see ultimately what plays out.</p>

<p>The Puppet-Labs &quot;Razor-Server&quot; fork can be found <a href="https://github.com/puppetlabs/razor-server">here</a>. If you want to work with it, or test it locally, you can use the bits written by Egle <a href="http://anystacker.com/2014/01/vagrant-up-razor-server/">here</a>.</p>

<p>Hanlon, the CSC fork <a href="https://github.com/csc/Hanlon">here</a>, is being perused by Tom McSweeney who helped get the original razor off the ground.</p>

<p>To help me work with it and contribute some, I&#39;ve built a small Vagrant environment (largely basd on the Vagrant environment for &#39;the other&#39; razor.).</p>

<h2>Vagrant Up Hanlon</h2>

<p>To get started, clone the repo and vagrant up, like so:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git clone https://github.com/bunchc/vagrant-hanlon.git
cd vagrant-hanlon
vagrant up
</code></pre></div>
<p>What this does during the vagrant up process is:</p>

<ul>
<li>Install dnsmasq</li>
<li>Configure IPtables for NAT</li>
<li>Installs Mongodb</li>
<li>Installs Java</li>
<li>Installs RBENV</li>
<li>Installs both jruby and ruby 1.9.3</li>
<li>Downloads Hanlon</li>
<li>Starts Puma (to run Hanlon)</li>
<li>Pulls down a few images to add to Hanlon</li>
</ul>

<p>Once you have Hanlon running, command wise it works very similar to the old Razor. That is:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">hanlon node
hanlon policy
hanlon image
</code></pre></div>
<h2>Summary</h2>

<p>In this post, you cloned and started to work with Hanlon, one of the derivatives of the Razor bare-metal provisioning framework.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/08/14/Updated-Blog--Markdown-workflow/">
        Updated Blog / Markdown workflow
      </a>
    </h1>

    <span class="post-date">14 Aug 2014</span>

    <p>A while ago I posted about my markdown <a href="http://openstack.prov12n.com/my-markdown-workflow-for-now/">workflow</a>. While that workflow was decent and worked for a goodly little while, it left quite a bit to be desired. Specifically, I the posting process into Wordpress was cumbersome at best.</p>

<h2>A New Blog Engine</h2>

<p>Like I said above, working with Wordpress and markdown was cumbersome and then some. So it was time for something new. At first I was going to use similar to <a href="https://github.com/chalupaul/chalupaul.github.io/">this</a>, which is actually what is in use on the <a href="http://openstackcookbook.com/">openstackcookbook.com</a> site. It has the following benefits:</p>

<ul>
<li>Posts are written in Markdown</li>
<li>Integrated with gh-pages</li>
<li>Straighforward publishing process <code>git push origin master</code></li>
</ul>

<p>It was <em>almost</em> what I needed. In the end I went with <a href="http://hugo.spf13.com/">Hugo</a>. What Hugo added was some pluggable themes and templates. Also the ability to run locally before pushing to github.</p>

<blockquote>
<p>To setup Hugo on github, use <a href="http://hugo.spf13.com/tutorials/github_pages_blog">this</a>.</p>
</blockquote>

<h2>Current Workflow</h2>

<p>My current workflow needed some help then. I kept the same sublime text plugins, that is:</p>

<ul>
<li>MarkdownEditing

<ul>
<li>This has a number of really handy keyboard bindings. It also has some decent highlighting and what not.</li>
</ul></li>
<li>Markdown Preview

<ul>
<li>This one allows me to go from Markdown into what itâ€™ll look like on the web.</li>
</ul></li>
<li>Markdown TOC

<ul>
<li>This lets me go from a basic set of sections and files into a more full fledged table of contents.</li>
</ul></li>
</ul>

<p>Additionally, to create a new post, I modified the Rakefile found <a href="https://github.com/chalupaul/chalupaul.github.io/blob/master/_posts/Rakefile">here</a>, to look like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">require &#39;fileutils&#39;
task :post do
    title = ENV[&#39;title&#39;] || &quot;new-post&quot;
    tags = ENV[&#39;tags&#39;] || &#39;&#39;
    make_img_dir = ENV[&#39;imgdir&#39;] || false
    date = (ENV[&#39;date&#39;] ? Time.parse(ENV[&#39;date&#39;]) : Time.now).strftime(&#39;%Y-%m-%d&#39;)
    filename = File.join(&#39;.&#39;, &quot;#{Time.now.strftime(&#39;%Y-%m-%d&#39;)}-#{title.strip.gsub(&#39; &#39;, &#39;-&#39;).gsub(/[^\w-]/, &#39;&#39;)}.md&quot;)
    open(filename, &#39;w&#39;) do |post|
        post.puts &quot;---&quot;
        post.puts &quot;title: \&quot;#{title}\&quot;&quot;
        post.puts &quot;date: #{Time.now.strftime(&#39;%Y-%m-%d&#39;)}&quot;
        post.puts &quot;categories: &quot;
        post.puts &quot;---&quot;
        post.puts &quot;\nYour content here.&quot;
        if make_img_dir
            img_dir = File.basename(filename.chomp(File.extname(filename)))
            FileUtils.mkdir_p(&quot;../images/posts/#{img_dir}&quot;)
            post.puts &quot;\n&quot; * 5
            post.puts &quot;[imgdir]: /images/posts/#{img_dir}/&quot;
        end
    end
end
</code></pre></div>
<p>So creating a new post goes like this:
bunchc: blog/content/posts$ rake post title=&quot;Title Here&quot;</p>

<p>In turn, that creates a YYYY-MM-DD-Title-Here.md file for editing in sublime. It also adds the metadata section at the top of the file for me:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">---
title: &quot;Updated Blog / Markdown workflow&quot;
date: 2014-08-14
categories: 
---
</code></pre></div>
<p>From there, I write the file, save the file, and run <code>./deploy.sh</code> from the Hugo installer linked earlier. That handles all the pushing and bits to git.</p>

<h2>Summary</h2>

<p>The gist of it is, Wordpress was a bit much and a bit heavy for what I needed. Hugo, Markdown, and GitHub Pages gave me a streamlined process that looks decent for posting.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/08/14/Multi-Node-Devstack-with-Neutron-and-Cells/">
        Multi-Node Devstack with Neutron and Cells
      </a>
    </h1>

    <span class="post-date">14 Aug 2014</span>

    <p>OpenStack Cells allow you to break up Nova into smaller domains. In turn, this allows for a number of interesting things. Not the least of which is scale.</p>

<p>From the OpenStack.org docs: <strong>Note</strong> <em>I&#39;ve added the bold on some important points.</em></p>

<blockquote>
<p>Cells functionality enables you to scale an OpenStack Compute cloud in a more distributed fashion without having to use complicated technologies like database and message queue clustering. It supports very large deployments.</p>

<p>When this functionality is enabled, the hosts in an OpenStack Compute cloud are partitioned into groups called cells. Cells are configured as a tree. The top-level cell should have a host that runs a nova-api service, but no nova-compute services. Each child cell should run all of the typical nova-* services in a regular Compute cloud except for nova-api. <strong>You can think of cells as a normal Compute deployment in that each cell has its own database server and message queue broker.</strong></p>
</blockquote>

<p>So, in addition to breaking down at physical boundaries or failure domains, you can break nova-compute into smaller chunks based on DB and MQ scaling limits. </p>

<p>However, not all of us have multi-geo hundred plus node compute labs to play with... so how do we test out this functionality before hand? Devstack!</p>

<h2>Getting Started</h2>

<p>tl;dr - <code>git clone https://github.com/bunchc/devstack-cells.git; cd devstack-cells; vagrant up</code>, and go to &quot;Configuring and Creating Cells&quot;</p>

<p>To get started, you&#39;ll need the following:</p>

<ul>
<li>virtualbox (fusion or workstation work just as well)</li>
<li>a minimum of two Ubuntu 14.04 VM with:

<ul>
<li>About 2GB ram</li>
<li>2x networks

<ul>
<li>eth0 = NAT</li>
<li>eth1 = host only</li>
</ul></li>
</ul></li>
</ul>

<h3>Both Nodes</h3>

<p>Once you have that taken care of, on each node we need to create a stack user:
<code>
sudo adduser --disabled-password --gecos &quot;&quot; stack
echo &quot;stack ALL=(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers
</code></p>

<h3>Parent Node</h3>

<p>Time to Download devstack:
<code>
sudo su - stack
git clone -b stable/icehouse https://github.com/openstack-dev/devstack 
</code></p>

<blockquote>
<p>Note the sudo command. Everything from this point is done as stack</p>
</blockquote>

<p>Next, let&#39;s make the local.conf file:
```
echo &quot;
[[local|localrc]]
ADMIN<em>PASSWORD=$ADMIN</em>PASSWORD
DATABASE<em>PASSWORD=$ADMIN</em>PASSWORD
RABBIT<em>PASSWORD=$ADMIN</em>PASSWORD
SERVICE<em>PASSWORD=$ADMIN</em>PASSWORD
SERVICE_TOKEN=a682f596-76f3-11e3-b3b2-e716f9080d50</p>

<p>GIT<em>BASE=${GIT</em>BASE:-https://git.openstack.org}</p>

<h1>Cells!</h1>

<p>ENABLED<em>SERVICES+=,n-cell,n-api-meta
DISABLED</em>SERVICE+=,n-cpu,n-net,n-sch</p>

<h1>Neutron - Networking Service</h1>

<h1>If Neutron is not declared the old good nova-network will be used</h1>

<p>ENABLED_SERVICES+=,q-svc,q-agt,q-dhcp,q-l3,q-meta,neutron,q-lbaas,q-vpn,q-fwaas</p>

<h1>Neutron Stuff</h1>

<p>OVS<em>VLAN</em>RANGES=RegionOne:1:4000
OVS<em>ENABLE</em>TUNNELING=False</p>

<h2>Images</h2>

<h1>32bit image (~660MB)</h1>

<p>IMAGE_URLS+=&quot;,http://fedorapeople.org/groups/heat/prebuilt-jeos-images/F19-i386-cfntools.qcow2&quot;</p>

<h1>64bit image (~640MB)</h1>

<p>IMAGE<em>URLS+=&quot;,http://fedorapeople.org/groups/heat/prebuilt-jeos-images/F19-x86</em>64-cfntools.qcow2&quot;
IMAGE<em>URLS+=&quot;,http://mirror.chpc.utah.edu/pub/fedora/linux/releases/20/Images/x86</em>64/Fedora-x86<em>64-20-20131211.1-sda.qcow2&quot;
IMAGE</em>URLS+=&quot;,http://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-uec.tar.gz&quot;</p>

<h1>Output</h1>

<p>LOGFILE=/opt/stack/logs/stack.sh.log
VERBOSE=True
LOG<em>COLOR=False
SCREEN</em>LOGDIR=/opt/stack/logs
&quot; | tee -a /home/stack/devstack/local.conf
```</p>

<p>The important bit for cells in this file are:
<code>
ENABLED_SERVICES+=,n-cell,n-api-meta
DISABLED_SERVICE+=,n-cpu,n-net,n-sch
</code></p>

<p>This enables the cell service, and the nova-api metadata service. It then disables compute, nova-networking, and the scheduler. Those tasks will be handled on the children.</p>

<p>With that out of the way run <code>./stack.sh</code> and grab a coffee. When it completes, add the following to <code>/etc/nova/nova.conf</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[cells]
enable=True
name=api
cell_type=api
</code></pre></div>
<p>Finally, restart the n-api serivice.</p>

<h3>Child Node</h3>

<p>Time to Download devstack:
<code>
sudo su - stack
git clone -b stable/icehouse https://github.com/openstack-dev/devstack 
</code></p>

<blockquote>
<p>Note the sudo command. Everything from this point is done as stack</p>
</blockquote>

<p>Next, on the child node, we create a local.conf file
```
cd devstack
echo &quot;
[[local|localrc]]
ADMIN<em>PASSWORD=$ADMIN</em>PASSWORD
DATABASE<em>PASSWORD=$ADMIN</em>PASSWORD
RABBIT<em>PASSWORD=$ADMIN</em>PASSWORD
SERVICE<em>PASSWORD=$ADMIN</em>PASSWORD
SERVICE_TOKEN=a682f596-76f3-11e3-b3b2-e716f9080d50</p>

<p>HOST<em>IP=<ipaddres of eth0>
SERVICE</em>HOST=<ip address of controllers eth0>
MYSQL<em>HOST=$SERVICE</em>HOST
RABBIT<em>HOST=$SERVICE</em>HOST
Q<em>HOST=$SERVICE</em>HOST
GLANCE<em>HOSTPORT=$SERVICE</em>HOST:9292</p>

<p>GIT<em>BASE=${GIT</em>BASE:-https://git.openstack.org}</p>

<h1>Cells!</h1>

<p>ENABLED<em>SERVICES+=,n-cell
DISABLED</em>SERVICE+=,n-api,key,g-api</p>

<h1>Neutron - Networking Service</h1>

<h1>If Neutron is not declared the old good nova-network will be used</h1>

<p>ENABLED_SERVICES+=,q-svc,q-agt,q-dhcp,q-l3,q-meta,neutron,q-lbaas,q-vpn,q-fwaas</p>

<h1>Neutron Stuff</h1>

<p>OVS<em>VLAN</em>RANGES=RegionOne:1:4000
OVS<em>ENABLE</em>TUNNELING=False</p>

<h1>Output</h1>

<p>LOGFILE=/opt/stack/logs/stack.sh.log
VERBOSE=True
LOG<em>COLOR=False
SCREEN</em>LOGDIR=/opt/stack/logs
&quot; | tee -a /home/stack/devstack/local.conf
```</p>

<p>The important bit for cells is:
<code>
ENABLED_SERVICES+=,n-cell
DISABLED_SERVICE+=,n-api,key,g-api
</code></p>

<p>This enables the cell service and turns of keystone along with nova-api and glance-api services. Those in turn will be handled by the parent.</p>

<p>Next, run <code>./stack.sh</code> and grab a coffee. When it completes, add the following to <code>/etc/nova/nova.conf</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[cells]
enable=True
name=cell1
cell_type=comput
</code></pre></div>
<h2>Configuring and Creating Cells</h2>

<p>Ok, what happened above was we got two nodes up and running and ready to go with Devstack and the prerequsite services for cells. Now we actually have to actuall make the cells. To do that:</p>

<h3>Parent</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">nova-manage cell create --name=cell1 --cell_type=child --username=guest --password=password --hostname=&lt;child ip&gt; --port=5672 --virtual_host=/ --woffset=1.0 --wscale=1.0
</code></pre></div>
<p>Then in screen, find the n-cell-* services and restart them.</p>

<h3>Child</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">nova-manage cell create --name=parent --cell_type=parent --username=guest --password=password --hostname=&lt;parent ip&gt; --port=5672 --virtual_host=/ --woffset=1.0 --wscale=1.0
</code></pre></div>
<p>Then in screen, find the n-cell-* services and restart them.</p>

<h2>Conclusion</h2>

<p>In this post, we created two virtual machines, installed Devstack while enabling nova-cells. Finally, we actually configured the cells to talk to one another. This post was largely an amalgamation of two other posts highlighted in the resources section</p>

<h2>Resources</h2>

<ul>
<li><a href="http://openlystacking.blogspot.com/2013/07/creating-cell-environment-using-devstack.html">http://openlystacking.blogspot.com/2013/07/creating-cell-environment-using-devstack.html</a></li>
<li><a href="http://www.xlcloud.org/bin/view/Blog/Devstack+with+Quantum+in+a+multi-node+configuration?language=en">http://www.xlcloud.org/bin/view/Blog/Devstack+with+Quantum+in+a+multi-node+configuration?language=en</a></li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/08/13/Linkdump-Bare-Metal-Edition/">
        Linkdump Bare-Metal Edition
      </a>
    </h1>

    <span class="post-date">13 Aug 2014</span>

    <p>Here goes the first post on the Hugo platform on the github blog. Some links I had to close out as I consolidated memory to fire up a multi-devstack.</p>

<ul>
<li><a href="http://theforeman.org/manuals/1.5/quickstart_guide.html">http://theforeman.org/manuals/1.5/quickstart_guide.html</a></li>
<li><a href="https://github.com/theforeman/foreman_discovery">https://github.com/theforeman/foreman_discovery</a></li>
<li><a href="http://www.cobblerd.org/">http://www.cobblerd.org/</a></li>
<li><a href="http://ma.ttwagner.com/bare-metal-deploys-with-devstack-and-ironic/">http://ma.ttwagner.com/bare-metal-deploys-with-devstack-and-ironic/</a></li>
</ul>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="/page6">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
